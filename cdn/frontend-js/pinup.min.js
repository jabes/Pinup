function PinUi(e){this.scope=e,this.hasUi=!1,this.isHidden=!1,this.allowPrivateInterfaces=!1,this.offsetLeft=0,this.offsetRight=0,this.leftNavItems=[{className:classes.btnAddnew,label:"ADD NEW TAG",isPrivate:!0,event:function(e,t){var s=function(){0===userInfo[serverKeys.user.tagTotal]?pfunc.openWindow(layout.msgFirstTag,function(){plib.click(plib.getElementsByClassName(classes.formBtnSubmit,this)[0],function(){pfunc.closeWindow(),e.scope.startTaggingMode(e.scope.methodAddNewTag)})}):e.scope.startTaggingMode(e.scope.methodAddNewTag)};pfunc.waitButton(t,messages.leftNavWait),pfunc.checkLogin(s,function(){pfunc.promptLogin(s)},function(){pfunc.unwaitButton(t)})}}]}function PinInst(e,t){this.uid=t,this.image=e,this.imageSrc=plib.attribute(e,settings.altImageSrc)||e.src,this.imageClone=e.cloneNode(!0),this.disallowNodeUpdate=!1,this.allowTagBubble=!0,this.privateElements={},this.settings={},this.dimensions={width:e.width,height:e.height,offsetLeft:cacheImages[t].offset.x,offsetTop:cacheImages[t].offset.y},this.updateInProgress=!1}function Pinup(e,t){if(window===this)return new Pinup(e,t);settings=plib.cloneObject(defaultSettings),t&&pfunc.updateSettings(t),pfunc.time(messages.sysLoadTime),pfunc.updateWindowNamespace(),plib.onDomReady(function(){var s,i=oNamespace.checkSite+globalVars.publicKey,n=function(e){e&&(pfunc.log(messages.serverSet,e),pfunc.updateSettings(e)),t&&pfunc.updateSettings(t),pfunc.systemStart()};return exist?void pfunc.warn(messages.noPubKey):(exist=!0,e&&(globalVars.publicKey=e),(s=pfunc.getLocalStorage(i))?n(s):plib.isUndefined(globalVars.publicKey)||plib.loadJSONP(directory.names.checkSite,{strWebUrl:window.location.hostname},function(e){null!==e&&(n(e),pfunc.setLocalStorage(i,e))}),void plib.addEvent(window,events.unload,pfunc.systemStop))})}var exist=!1,alive=!1,globalVars={},globalElements={},globalKeyEvents={},cacheImages={},cacheNodes={},cacheTags={},cacheTagData={},cacheEvents={},cacheElements={},queueTagData={},jsonpHandler={},jsonpTimeout={},userInfo={},userHash,userLogged=!1,support={},hiddenImages={},stats={},plib,pfunc,defaultSettings,settings,classes,directory,regex,messages,attributes,names,types,events,html,commonHTML,layout,css,serverKeys,document=window.document,protoString=Object.prototype.toString,windowLocation=window.location.href,defaultView=document.defaultView,consoleObject=window.console,consoleMethods=["log","info","warn","error","time","timeEnd"],cssPrefix="PIN_",tagPrefix="tagId_",sysName="Pinup",ieEventPrefix="on",cssUnit="px",monetarySymbol="$",whiteSpace=" ",asterisk="*",ellipsis="...",webProtos=["http://","https://"],defaultWebProto=webProtos[0],oNamespace={root:sysName,json:"jsonpHandler",globalVars:"globalVars",settings:"settings",defaultSettings:"defaultSettings",user:"user",lib:"lib",fn:"fn",images:"images",nodes:"nodes",tags:"tags",events:"events",elements:"elements",checkSite:"checkSite-",checkImage:"checkImage-",vmlCanvas:"G_vmlCanvasManager"},opacities={full:1,semi:.3},keyCodes={f2:113,esc:27,enter:13,arrowLeft:37,arrowRight:39},splElmIds={window:"GUID-window",document:"GUID-document"},strBool={1:"yes",0:"no"},readyStates={complete:"complete",loaded:"loaded"},NULL_TYPE="null",UNDEFINED_TYPE="undefined",BOOLEAN_TYPE="boolean",NUMBER_TYPE="number",STRING_TYPE="string",OBJECT_TYPE="object",ARRAY_TYPE="array",FUNCTION_TYPE="function",ELEMENT_TYPE="element",DATE_TYPE="date",BOOLEAN_CLASS="[object Boolean]",NUMBER_CLASS="[object Number]",STRING_CLASS="[object String]",ARRAY_CLASS="[object Array]",FUNCTION_CLASS="[object Function]",DATE_CLASS="[object Date]",nLastLoginCheck=0,scrollMem;(directory={names:{getTags:"get_tags",getTagSugg:"get_tag_suggestion",register:"register",login:"login",logout:"logout",forgot:"forgot_pass",checkLogin:"check_login",checkImage:"check_image",checkSite:"get_site_settings",tagCreate:"tag_create",tagPosition:"tag_position",tagRemove:"tag_remove",logTagHover:"log_tag_hover"},paths:{twitter:"http://twitter.com/intent/tweet?",facebook:"https://www.facebook.com/sharer.php?",gateway:"http://pinup.dev/gateway/",cdn:"http://pinup.dev/cdn/",website:"http://pinup.dev/"}}).paths.webloc=directory.paths.gateway+"webloc.php?u=",directory.paths.hub=directory.paths.gateway+"hub.php",directory.paths.themes=directory.paths.cdn+"frontend-themes/css/",directory.paths.excanvas=directory.paths.cdn+"global-js/excanvas.js",defaultSettings={nMinWidth:250,nMinHeight:200,jsonpTimeout:3e4,scrollDelay:300,navAniSpeed:250,loadImages:[],loadAll:!1,smartLoad:!0,forceListen:!1,alwaysShowTags:!0,cssHelper:!0,posHelper:!0,animations:!0,keyListener:!0,onReady:function(){},onLogout:function(){},onLogin:function(){},themeFile:"",allowFile:"jpg|jpeg|png",allowThemeManager:!1,allowLocalStorage:!1,allowBottomLinks:!1,allowShare:!0,dotSize:"medium",dotOutlineSize:6,canvas:{cornerRadius:5,tailWidth:19,tailHeight:8,stroke:!1,shadow:!0,theme:{backgroundStyle:"radial",backgroundColor:"0-#FFFFFF 1-#CCCCCC",strokeWidth:1,strokeColor:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:5,shadowColor:"#000000"}},tooltip:!0,tooltipOrientation:"top",tooltipURL:!0,altImageSrc:"pinsrc",activeParentClass:"allpins",activeChildClass:"pinimg",custom:{}},classes={docBody:cssPrefix+"active",noAnimation:cssPrefix+"noAnimation",noRgbaSupport:cssPrefix+"noRgbaSupport",noBoxShadowSupport:cssPrefix+"noBoxShadowSupport",noBorderRadiusSupport:cssPrefix+"noBorderRadiusSupport",wrapper:cssPrefix+"wrapper",lightbox:cssPrefix+"lightbox",lightboxWindow:cssPrefix+"lightboxWindow",lightboxOverlay:cssPrefix+"lightboxOverlay",lightboxImage:cssPrefix+"lightboxImage",lightboxImageHolder:cssPrefix+"lightboxImageHolder",lightboxNav:cssPrefix+"lightboxNav",lightboxShowLeft:cssPrefix+"lightboxShowLeft",lightboxShowRight:cssPrefix+"lightboxShowRight",lightboxNavIcon:cssPrefix+"lightboxNavIcon",node:cssPrefix+"node",inlineNode:cssPrefix+"inlineNode",sectionBody:cssPrefix+"sectionBody",sectionFooter:cssPrefix+"sectionFooter",image:cssPrefix+"image",overlay:cssPrefix+"overlay",logo:cssPrefix+"logo",button:cssPrefix+"button",lastItem:cssPrefix+"lastItem",noSelect:cssPrefix+"noSelect",handOver:cssPrefix+"handOver",handDrag:cssPrefix+"handDrag",iconLabel:cssPrefix+"iconLabel",guiLeftHolder:cssPrefix+"guiLeftHolder",guiRightHolder:cssPrefix+"guiRightHolder",guiBotL:cssPrefix+"btnBotL",guiTopR:cssPrefix+"btnTopR",btnCancel:cssPrefix+"btnCancel",btnSettings:cssPrefix+"btnSettings",btnAddnew:cssPrefix+"btnAddTag",window:cssPrefix+"window",windowOverlay:cssPrefix+"windowOverlay",windowBackground:cssPrefix+"windowBackground",windowClose:cssPrefix+"windowBtnClose",windowBody:cssPrefix+"windowBody",windowLogout:cssPrefix+"windowLogout",windowUserName:cssPrefix+"windowUserName",windowHeader:cssPrefix+"header",windowTitle:cssPrefix+"title",prompt:cssPrefix+"prompt",promptMessage:cssPrefix+"promptMessage",promptAccept:cssPrefix+"promptAccept",promptDeny:cssPrefix+"promptDeny",modalMsg:cssPrefix+"modalMsg",focus:cssPrefix+"focus",formStyle:cssPrefix+"formStyle",formError:cssPrefix+"formError",formDisabledMsg:cssPrefix+"formDisabledMsg",formErrorRow:cssPrefix+"formErrorRow",formLabel:cssPrefix+"formLabel",formLabelSm:cssPrefix+"formLabel-sm",formTextField:cssPrefix+"textField",formTextArea:cssPrefix+"textArea",formDropDown:cssPrefix+"dropDown",formDropDownDiv:cssPrefix+"dropDownDiv",formBtnSubmit:cssPrefix+"formBtnSubmit",formBtnLeft:cssPrefix+"formBtnLeft",formOptions:cssPrefix+"options",formOption_forgotPass:cssPrefix+"optForgotPass",formOption_backToLogin:cssPrefix+"optBackToLogin",formOption_register:cssPrefix+"optRegister",tag:cssPrefix+"tag",tagSmall:cssPrefix+"tagSmall",tagMedium:cssPrefix+"tagMedium",tagLarge:cssPrefix+"tagLarge",tagHolder:cssPrefix+"tagHolder",tagDot:cssPrefix+"tagDot",tagOutline:cssPrefix+"tagOutline",tagBubble:cssPrefix+"tagBubble",tagBubbleContent:cssPrefix+"tagBubbleContent",tagBubbleCanvas:cssPrefix+"tagBubbleCanvas",tagBubbleButton:cssPrefix+"tagBubbleButton",tagLink:cssPrefix+"tagLink",tagLinkText:cssPrefix+"tagLinkText",tagLinkURL:cssPrefix+"tagLinkURL",tagLinkLike:cssPrefix+"tagLinkLike",tagDirLeft:cssPrefix+"tagDirL",tagDirRight:cssPrefix+"tagDirR",link:cssPrefix+"link",linkHolder:cssPrefix+"linkHolder",linkHolderBackground:cssPrefix+"linkHolderBackground",linkPending:cssPrefix+"linkPending",shareHolder:cssPrefix+"shareHolder",shareHeader:cssPrefix+"shareHeader",shareButtons:cssPrefix+"shareButtons",shareButton:cssPrefix+"shareButton",actionOn:cssPrefix+"on",actionShowWin:cssPrefix+"showWin",taggingMode:cssPrefix+"taggingMode",repositionMode:cssPrefix+"repositionMode",removalMode:cssPrefix+"removalMode"},messages={noImages:sysName+": No images have been found",imageLoaded:sysName+": Image has loaded: %o",imageUnloaded:sysName+": Image has been unloaded: %s",imageNewSrc:sysName+': Image src "%s" was replaced with: "%s"',imageCount:sysName+": We found %i images; %i of those have been loaded and %i of those have been denied",sysDestroyed:sysName+": All instances have been removed",themeLoaded:sysName+': The theme "%s" has loaded',excanvasRequest:sysName+": Excanvas has been requested",excanvasReceived:sysName+": Excanvas has been loaded then initialized and canvas is %s",noPubKey:sysName+": Public key was not provided",alreadyAlive:sysName+": System already active",alreadyDead:sysName+": System does not exist",badInstance:sysName+": Image already contains a valid identifier",noInstance:sysName+": Image does not contain a valid identifier",badTarget:sysName+": Event target is undefined",noImage:sysName+": Aborted due to faulty or non-existant image reference",inBlacklist:sysName+": Image was rejected because it was found in the blacklist %o",imageTooSmall:sysName+": Image was rejected because it did not meet the minimum size requirements: width(%spx/%spx) and height(%spx/%spx) %o",imageNoSrc:sysName+": Image was rejected because it does not have a file source %o",imageBadFile:sysName+': Image was rejected because of an unknown file type "%s" on %o',imageNotFound:sysName+": Image has been removed from the document and will no longer be able to load %o",imageIgnoreSEO:sysName+": Image was rejected because it appears to be a SEO pseudo tag %o",sysNotActive:sysName+": Requested action not performed because the system is not active",eventDuplicate:sysName+': Ignored duplicate event type "%s" on %o',settingDNF:sysName+': Custom setting "%s" was not found',badType:sysName+': Custom setting "%s" was ignored because of mismatched type (expected %s but found %s)',themeNotFound:sysName+': The theme "%s" was not found. The default theme was loaded',jsonp:sysName+": JSONP CALL: %s",serverSet:sysName+": Settings from server: %o",instOutput:sysName+": Instance done: %o",jsonpTimeout:sysName+": JSONP call has timed out on script: %s",sysLoadTime:sysName+": Load Time",noResults:"No results found.",loading:"Loading"+ellipsis,leftNavWait:"THINKING"+ellipsis,formWait:"PLEASE WAIT"+ellipsis,removeTag:"Are you sure you wish to permanently delete this tag?",removeMultiTags:"Are you sure you wish to permanently delete this tag? Caution: There are multiple links associated with this tag.",missingReqInput:"A REQUIRED FIELD IS EMPTY",invalidEmail:"EMAIL ADDRESS IS NOT VALID"},css={display:"display",margin:{top:"marginTop",right:"marginRight",bottom:"marginBottom",left:"marginLeft"},padding:{top:"paddingTop",right:"paddingRight",bottom:"paddingBottom",left:"paddingLeft"},width:"width",height:"height",maxWidth:"maxWidth",maxHeight:"maxHeight",top:"top",right:"right",bottom:"bottom",left:"left",visibility:"visibility",opacity:"opacity",filter:"filter",zIndex:"zIndex",cssFloat:"float",position:"position"},attributes={id:"id",className:"class",style:"style",src:"src",href:"href",rel:"rel",name:"name",type:"type",width:"width",height:"height",align:"align",hspace:"hspace",vspace:"vspace",unselectable:"unselectable",disabled:"disabled",readonly:"readonly",selected:"selected",autoComplete:"autocomplete",tagGuid:"taguid",tagMultiGuid:"taguids",tagName:"tagname",tagKeywords:"keywords",tagWebLink:"weblink",tagPosX:"posx",tagPosY:"posy",tagOwnerId:"ownerid",tagHover:"taghover",fluidWidth:"fluidwidth",hiddenKey:"hiddenkey",imgLoaded:"loaded",orgText:"orgtext",isVisible:"isvis",guid:"guid"},names={formRegister:cssPrefix+"registerForm",formLogin:cssPrefix+"loginForm",formForgot:cssPrefix+"formForgot",formCreate:cssPrefix+"newTagForm",formSettings:cssPrefix+"formSettings",strFullName:"strFullName",strUsername:"strUsername",strPassword:"strPassword",strConfirmPass:"strConfirmPass",strWebName:"strWebName",strWebURL:"strWebURL",nTagID:"nTagID",strWebReferer:"strWebReferer",strImageURL:"strImageURL",strTagName:"strTagName",strKeywords:"strKeywords",strWebLink:"strWebLink",nPosX:"nPosX",nPosY:"nPosY",strComments:"strComments",btnRepositionTags:"btnRepositionTags",btnRemoveTags:"btnRemoveTags",btnOpenLightbox:"btnOpenLightbox"},types={button:"button",submit:"submit",text:"text",password:"password",hidden:"hidden",jstxt:"text/javascript",csstxt:"text/css"},events={submit:"submit",scroll:"scroll",click:"click",load:"load",unload:"unload",keyup:"keyup",focus:"focus",blur:"blur",change:"change",mouseover:"mouseover",mouseout:"mouseout",mousedown:"mousedown",mouseup:"mouseup",mousemove:"mousemove",touchstart:"touchstart",touchend:"touchend",selectstart:"selectstart",readystatechange:"readystatechange",domcontentloaded:"domcontentloaded"},html={script:"script",link:"link",head:"head",body:"body",h2:"h2",p:"p",a:"a",br:"br",em:"em",ol:"ol",li:"li",strong:"strong",img:"img",div:"div",span:"span",form:"form",input:"input",select:"select",option:"option",textarea:"textarea",label:"label",button:"button",canvas:"canvas"},serverKeys={user:{guid:"guid",tagTotal:"tagTotal",fullName:"fullName",isOwner:"isOwner"},tags:{guid:"strGUID",name:"strTagName",imagePath:"strImageURL",posX:"nPosX",posY:"nPosY",keywords:"arrKeywords",webLink:"strWebLink",ownerGuid:"nTaggerAccountsID"}},regex={csv:/[\s,]+/,ss:/\s/g,ltrim:/^\s\s*/,rtrim:/\s\s*$/,purl:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,query:/(?:^|&)([^&=]*)=?([^&]*)/g,nump:/[^0-9\.\-]+/g,camel:/-+(.) ?/g,tslash:/\/$/g,fext:/[^.]+$/,opacity:/^0.55$/,mobile:/android|webos|iphone|ipad|ipod|blackberry/i},globalVars.availableThemes={default:825248,launch:469725,virgin:979253},globalVars.availableDotSizes={small:classes.tagSmall,medium:classes.tagMedium,large:classes.tagLarge},globalVars.tooltipOrientations={top:"top",right:"right",bottom:"bottom",left:"left"},globalVars.canvasDrawStyles={radial:"radial",linear:"linear",solid:"solid"},plib={onDomReady:function(e){var t=document.addEventListener?events.domcontentloaded:events.readystatechange,s=function(){plib.removeEvent(document,t),plib.removeEvent(window,events.load)};document.readyState!==readyStates.complete?(plib.addEvent(document,t,function(){document.readyState===readyStates.complete&&(s.call(),e.call())}),plib.addEvent(window,events.load,function(){s.call(),e.call()})):e.call()},loadScript:function(e,t){var s,i={},n=function(){plib.removeEvent(s,events.readystatechange),plib.removeEvent(s,events.load)};i[attributes.src]=e,i[attributes.type]=types.jstxt,s=plib.domAppend(html.script,document.getElementsByTagName(html.head)[0],i),plib.addEvent(s,events.readystatechange,function(){s.readyState!==readyStates.complete&&s.readyState!==readyStates.loaded||(n.call(),t(s))}),plib.addEvent(s,events.load,function(){n.call(),t(s)})},type:function(e){switch(e){case null:return NULL_TYPE;case void 0:return UNDEFINED_TYPE}switch(protoString.call(e)){case BOOLEAN_CLASS:return BOOLEAN_TYPE;case NUMBER_CLASS:return NUMBER_TYPE;case STRING_CLASS:return STRING_TYPE;case ARRAY_CLASS:return ARRAY_TYPE;case FUNCTION_CLASS:return FUNCTION_TYPE;case DATE_CLASS:return DATE_TYPE}return 1===e.nodeType?ELEMENT_TYPE:OBJECT_TYPE},isElement:function(e){return plib.type(e)===ELEMENT_TYPE},isNull:function(e){return plib.type(e)===NULL_TYPE},isUndefined:function(e){return plib.type(e)===UNDEFINED_TYPE},isBoolean:function(e){return plib.type(e)===BOOLEAN_TYPE},isNumber:function(e){return plib.type(e)===NUMBER_TYPE},isString:function(e){return plib.type(e)===STRING_TYPE},isObject:function(e){return plib.type(e)===OBJECT_TYPE},isFunction:function(e){return plib.type(e)===FUNCTION_TYPE},isArray:function(e){return plib.type(e)===ARRAY_TYPE},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},hasClass:function(e,t){return new RegExp("\\b"+t+"\\b").test(e.className)},addClass:function(e,t){plib.hasClass(e,t)||(e.className+=e.className?whiteSpace+t:t)},removeClass:function(e,t){var s=e.className.match(whiteSpace+t)?whiteSpace+t:t;e.className=e.className.replace(s,"")},getParentByClassName:function(e,t){for(;e&&!plib.hasClass(e,t);)e=e.parentNode||null;return e},getElementsByClassName:function(e,t){var s=[];return t=t||document.getElementsByTagName(html.body).item(0),plib.loopArray(t.getElementsByTagName(asterisk),function(t){plib.hasClass(t,e)&&s.push(t)}),s},hasProperty:function(e,t){var s=Object.prototype.hasOwnProperty,i="__proto__";return s?s.call(e,t):(i=e[i]||e.constructor.prototype,!plib.isUndefined(e[t])&&(plib.isUndefined(i[t])||i[t]!==e[t]))},loop:function(e,t){for(var s=0;s<e&&null!==t(s);)s++},rloop:function(e,t){for(;e--;)t(e)},loopArray:function(e,t){plib.loop(e.length,function(s){return 2===t.length?t(s,e[s]):t(e[s])})},loopObject:function(e,t){var s;for(s in e)if(1===t.length){if(null===t(e[s]))break}else if(2===t.length&&null===t(s,e[s]))break},loopObjectKeys:function(e,t){var s;for(s in e)if(null===t(s))break},isObjectEmpty:function(e){var t;for(t in e)if(plib.hasProperty(e,t))return!1;return!0},mergeObject:function(e,t){var s;for(s in t)e[s]=t[s];return e},cloneObject:function(e){var t={};return plib.isObject(e)?(plib.loopObject(e,function(e,s){t[e]=plib.cloneObject(s)}),t):e},getParamsFromObject:function(e){var t=[];return plib.loopObject(e,function(e,s){t[t.length]=encodeURIComponent(e)+"="+encodeURIComponent(s)}),t.join("&")},getEventTarget:function(e){var t;return e=e||window.event,3===(t=e.target||e.srcElement).nodeType&&(t=t.parentNode),t},randomID:function(e){for(var t="",s=0,i="0123456789ABCDEFGHIJKLMNOPQURSTUVWXYZ";s<e;)t+=i.substr(Math.floor(Math.random()*i.length),1),s++;return t},getMousePosition:function(e){e=e||window.event;var t=document.documentElement,s=document.body,i={x:0,y:0};return e.pageX||e.pageY?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX+(t.scrollLeft||s.scrollLeft)-t.clientLeft,i.y=e.clientY+(t.scrollTop||s.scrollTop)-t.clientTop),i},getWidth:function(e){var t=e.offsetWidth||e.clientWidth;return t||(plib.setStyle(e,css.visibility,"hidden"),plib.show(e),t=e.offsetWidth||e.clientWidth,plib.hide(e),plib.setStyle(e,css.visibility,"visible")),t||0},setWidth:function(e,t){plib.setStyle(e,css.width,t)},getHeight:function(e){var t=e.offsetHeight||e.clientHeight;return t||(plib.setStyle(e,css.visibility,"hidden"),plib.show(e),t=e.offsetHeight||e.clientHeight,plib.hide(e),plib.setStyle(e,css.visibility,"visible")),t||0},setHeight:function(e,t){plib.setStyle(e,css.height,t)},getCumulativeOffset:function(e){var t={x:0,y:0};if(e.offsetParent)do{t.x+=e.offsetLeft,t.y+=e.offsetTop,e=e.offsetParent}while(e);return t},attribute:function(e,t,s){var i=e.nodeType;if(e&&3!==i&&8!==i&&2!==i)return plib.isObject(t)?void plib.loopObject(t,function(t,s){plib.attribute(e,t,s)}):plib.isUndefined(s)?e.getAttribute(t):null===s||!1===s?void("class"===t?plib.removeClass(e,s):e.removeAttribute(t)):("class"===t?plib.addClass(e,s):e.setAttribute(t,s),s)},getGUID:function(e){var t;return e===window?t=splElmIds.window:e===document?t=splElmIds.document:(t=plib.attribute(e,attributes.guid))||(t=plib.attribute(e,attributes.guid,plib.randomID(16))),t},setStyles:function(e,t){plib.loopObject(t,function(t,s){plib.setStyle(e,t,s)})},setStyle:function(e,t,s){var i=e.style;t=t===css.cssFloat?support.cssFloat:t,i&&e&&3!==e.nodeType&&8!==e.nodeType&&(t!==css.opacity?(plib.isNumber(s)&&!plib.inArray([css.zIndex,css.opacity],t)&&(s+=cssUnit),pfunc.attempt(function(){i[t]=s})):plib.setAlpha(e,s))},getStyle:function(e,t,s){var i,n;return plib.isString(e)&&(s=t,t=e,e=void 0),"auto"===(i=t!==css.opacity||support.opacity?(s=s||plib.getComputedStyles(e))[t]:(n=plib.getStyle(e,css.filter,s))?parseFloat(n.replace(regex.nump,""))/100:null)?null:i},getComputedStyles:function(e){var t={},s=defaultView?defaultView.getComputedStyle(e,null):e.currentStyle,i=s.length,n=function(e){var i,n,o;plib.isUndefined(s.getPropertyValue)||(i=s.getPropertyValue(e)),i||(i=s[e]),i&&(n=plib.type(i),(plib.isNumeric(i)&&n!==NUMBER_TYPE||n===STRING_TYPE&&i.indexOf(cssUnit)>0)&&(o=parseFloat(i),isNaN(o)||(i=o)),t[plib.camelize(e)]=i)};return i?plib.loop(i,function(e){n(s[e])}):plib.loopObjectKeys(s,function(e){plib.hasProperty(s,e)&&n(e)}),t},camelize:function(e){return e.replace(regex.camel,function(e,t){return t?t.toUpperCase():""})},stopBubble:function(e){(e=e||window.event).preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},removeChildren:function(e){if(e)for(;e.hasChildNodes();)plib.removeElement(e.firstChild)},cleanElement:function(e){var t=plib.getGUID(e);plib.removeAllEvents(e),plib.removeChildren(e),pfunc.removeAllKeyListeners(t),delete cacheElements[t]},removeElement:function(e){e&&(plib.cleanElement(e),e.parentNode&&e.parentNode.removeChild(e))},replaceElement:function(e,t){plib.cleanElement(e),plib.isString(t)&&(t=document.createTextNode(t)),e.parentNode&&e.parentNode.replaceChild(t,e)},insertBefore:function(e,t){return e.parentNode.insertBefore(t,e),t},insertAfter:function(e,t){return plib.isString(t)&&(t=document.createTextNode(t)),e.parentNode.insertBefore(t,plib.getNextSibling(e)),t},getNextSibling:function(e){do{e=e.nextSibling}while(e&&1!==e.nodeType);return e},newElement:function(e,t,s){var i=document.createElement(e),n=plib.getGUID(i);return cacheElements[n]=i,t&&plib.isString(t)&&(s=s||t,t={}),t&&plib.isObject(t)&&plib.attribute(i,t),s&&plib.isString(s)&&plib.appendText(i,s),i},domAppend:function(e,t,s,i){var n,o;return s&&plib.isString(s)&&(i=i||s,s={}),plib.isString(e)&&(e=plib.newElement(e,s,i)),n=e.nodeType,o=t.nodeType,1!==n&&11!==n&&3!==n||1!==o&&11!==o&&3!==o||t.appendChild(e),e},domWrap:function(e,t,s,i){return s&&plib.isString(s)&&(i=i||s,s={}),plib.isString(e)&&(e=plib.newElement(e,s,i)),plib.isElement(e)&&plib.isElement(t)&&(t.parentNode.insertBefore(e,t),plib.domAppend(t,e)),e},isElementIn:function(e,t){for(;e;){if(e===t||e.nodeName.toLowerCase()===t)return!0;e=e.parentNode}return!1},isElementEmpty:function(e){return 0===e.children.length},parseHTML:function(e,t){var s,i=document.createDocumentFragment();return s=function(e){var i,n={};return plib.hasProperty(e,t.id)&&(n.id=e[t.id]),plib.hasProperty(e,t.className)&&(n.class=e[t.className]),plib.hasProperty(e,t.attr)&&plib.loopObject(e[t.attr],function(e,t){n[e]=t}),plib.hasProperty(e,t.nodeName)&&(i=plib.newElement(e[t.nodeName],n),e[t.childNodes]&&e[t.childNodes].length>0&&plib.loopArray(e[t.childNodes],function(e){plib.domAppend(s(e),i)})),e[t.text]&&e[t.text].length>0&&(i?plib.appendText(i,e[t.text]):i=document.createTextNode(e[t.text])),i},t=t||{nodeName:"nodeName",childNodes:"childNodes",className:"className",id:"id",attr:"attr",text:"text"},plib.isArray(e)?plib.loopArray(e,function(e){plib.domAppend(s(e),i)}):plib.isObject(e)&&plib.domAppend(s(e),i),i},replaceHTML:function(e,t){plib.removeChildren(e),plib.isString(t)?plib.appendText(e,t):e.appendChild(plib.parseHTML(t))},appendText:function(e,t){if(t.length>0)return e.appendChild(document.createTextNode(t))},textContentRecursive:function(e,t){for(;e;){if(!e.firstChild||!plib.isElement(e.firstChild))return t?plib.textContent(e,t):plib.textContent(e);e=e.firstChild}},textContent:function(e,t){var s,i,n;for(s=0,i=e.childNodes.length;s<i;s++)if(3===(n=e.childNodes[s]).nodeType)return t&&(n.nodeValue=t),n.nodeValue;return t?plib.appendText(e,t):""},disableSelection:function(e){plib.isUndefined(e.onselectstart)||(e.onselectstart=function(){return!1}),plib.addClass(e,classes.noSelect),plib.attribute(e,attributes.unselectable,"on")},show:function(e){e.style[css.display]="block"},hide:function(e){e.style[css.display]="none"},isVisible:function(e){var t=plib.getComputedStyles(e);return!("hidden"===plib.getStyle(css.visibility,t)||"none"===plib.getStyle(css.display,t)||0===plib.getStyle(css.opacity,t))},handleEvent:function(e){e=e||window.event,plib.stopBubble(e);var t=this,s=!0,i=t.events[e.type];return plib.loopObjectKeys(i,function(n){t.handleEvent=i[n],!1===t.handleEvent(e)&&(s=!1)}),s},hasEvent:function(e,t){var s=plib.getGUID(e);return!(!cacheEvents[s]||!cacheEvents[s][t])},addEvent:function(e,t,s){var i,n=plib.getGUID(e);plib.hasEvent(e,t)?pfunc.warn(messages.eventDuplicate,t,e):(cacheEvents[n]||(cacheEvents[n]={}),cacheEvents[n][t]={element:e,handler:s},e.addEventListener?e.addEventListener(t,s,!1):(s.guid||(s.guid=plib.randomID(12)),e.events||(e.events={}),(i=e.events[t])||(i=e.events[t]={},e[ieEventPrefix+t]&&(i[0]=e[ieEventPrefix+t])),i[s.guid]=s,e[ieEventPrefix+t]=plib.handleEvent))},removeEvent:function(e,t){var s,i=plib.getGUID(e);plib.hasEvent(e,t)&&(s=cacheEvents[i][t].handler,delete cacheEvents[i][t],plib.isObjectEmpty(cacheEvents[i])&&delete cacheEvents[i],e.removeEventListener?e.removeEventListener(t,s,!1):e.events&&e.events[t]&&delete e.events[t][s.guid])},removeAllEvents:function(e){var t=plib.getGUID(e);cacheEvents[t]&&plib.loopObjectKeys(cacheEvents[t],function(t){plib.removeEvent(e,t)})},fireEvent:function(e,t){var s;plib.hasEvent(e,t)&&(document.createEvent?((s=document.createEvent("HTMLEvents")).initEvent(t,!0,!0),e.dispatchEvent(s)):((s=document.createEventObject()).eventType=ieEventPrefix+t,e.fireEvent(s.eventType,s)))},click:function(e,t,s){s=s||!1,t&&plib.addClass(e,classes.button),plib.addEvent(e,events.click,function(i){return plib.stopBubble(i),s&&(plib.removeEvent(e,events.click),plib.removeClass(e,classes.button)),t&&t.call(e,i),!1})},jsonpGarbageCollect:function(e){plib.removeElement(document.getElementById(e)),clearTimeout(jsonpTimeout[e]),delete jsonpTimeout[e],delete jsonpHandler[e]},loadJSONP:function(e,t,s){var i,n="JSONP_"+plib.randomID(12),o="",a=(new Date).getTime();t&&(plib.isFunction(t)?(s=t,t=""):plib.isObject(t)&&(o=(o=plib.getParamsFromObject(t))?"&"+o:"")),i=directory.paths.hub+"?r="+e+"&jsid="+n+"&pk="+globalVars.publicKey+o,settings.jsonpTimeout>0&&(jsonpTimeout[n]=setTimeout(function(){pfunc.error(messages.jsonpTimeout,i),s&&s(null,settings.jsonpTimeout),plib.jsonpGarbageCollect(n)},settings.jsonpTimeout)),jsonpHandler[n]=function(e){var t=(new Date).getTime()-a;s&&s(e,t),plib.jsonpGarbageCollect(n)},plib.domAppend(html.script,document.getElementsByTagName(html.head).item(0),{id:n,src:i,type:types.jstxt}),pfunc.log(messages.jsonp,i)},stopAnimation:function(e){e.animationMemory&&clearInterval(e.animationMemory)},animate:function(e,t,s,i,n){var o,a=[],l=(new Date).getTime(),r=function(t,s){var i={};i.cssProp=t,i.startValue=plib.getStyle(e,i.cssProp)||0,i.endValue=s,i.displacement=i.endValue-i.startValue,isNaN(i.startValue)||isNaN(i.endValue)||isNaN(i.displacement)||a.push(i)};plib.isObject(t)?(n=i,i=s,s=null,plib.loopObject(t,function(e,t){r(e,t)})):r(t,s),0!==a.length&&(o=Math.PI/(2*i),e.animationMemory&&plib.stopAnimation(e),e.animationMemory=setInterval(function(){var t=(new Date).getTime()-l,s=Math.abs(Math.sin(t*o));t<i?plib.loopArray(a,function(t){plib.setStyle(e,t.cssProp,s*t.displacement+t.startValue)}):(plib.stopAnimation(e),plib.loopArray(a,function(t){plib.setStyle(e,t.cssProp,t.endValue)}),n&&n.call(e))},10))},setAlpha:function(e,t){support.opacity?e.style[css.opacity]=t:e.style[css.filter]="alpha(opacity = "+String(100*t)+") "},fadeTo:function(e,t,s,i){plib.animate(e,css.opacity,t,s,i)},fadeIn:function(e,t,s){plib.fadeTo(e,1,t,s)},fadeOut:function(e,t,s){plib.fadeTo(e,0,t,s)},stripSpaces:function(e){return e.replace(regex.ss,"")},inArray:function(e,t){var s=!1;return plib.loopArray(e,function(e){if(e===t)return s=!0,null}),s},arrayUnique:function(e){var t=[];return plib.loopArray(e,function(e){plib.inArray(t,e)||(t[t.length]=e)}),t},removeArrayItem:function(e,t){return plib.loopArray(e,function(s,i){i===t&&e.splice(s,1)}),e},parseUrl:function(e){for(var t=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],s="queryKey",i=regex.purl.exec(e),n={},o=14;o--;)n[t[o]]=i[o]||"";return n[s]={},n[t[12]].replace(regex.query,function(e,t,i){t&&(n[s][t]=i)}),n},getFileExtension:function(e){var t=e?plib.parseUrl(e).file:null,s=t?regex.fext.exec(t).pop():null;return s?s.toLowerCase():null},runInterval:function(e,t,s,i,n){var o,a=0;!0===s.call()?i.call():o=window.setInterval(function(){!0===s.call()?(clearInterval(o),i.call()):++a>=t&&(window.clearInterval(o),n&&n.call())},e)},stringFormat:function(e,t){var s=e;return plib.loopArray(t,function(e,t){var i=new RegExp("\\{"+e+"\\}","gi");s=s.replace(i,t)}),s}},commonHTML={buildForm:function(e,t,s){var i={};return t=[{nodeName:html.div,className:classes.formError}].concat(t),plib.isUndefined(s)||(t=t.concat([commonHTML.buildButton(s)])),i[attributes.name]=e,[{nodeName:html.form,id:e,className:classes.formStyle,attr:i,childNodes:t}]},buildFormInput:function(e,t){return{nodeName:html.input,attr:{type:e,name:t,autocomplete:"off"}}},buildFormTextArea:function(e){return{nodeName:html.textarea,attr:{name:e}}},buildFormSelect:function(e,t){var s=[];return plib.loopObject(t,function(e,t){s.push({nodeName:html.option,attr:{value:e},text:t})}),{nodeName:html.select,attr:{name:e},childNodes:s}},buildFormLabelSm:function(e,t){return commonHTML.buildFormLabel(e,t,!0)},buildFormLabel:function(e,t,s){var i={},n=s?classes.formLabelSm:classes.formLabel;return i[html.input]=classes.formTextField,i[html.textarea]=classes.formTextArea,i[html.select]=classes.formDropDown,{nodeName:html.label,className:n+whiteSpace+i[t.nodeName],text:e+":"+whiteSpace,childNodes:[{nodeName:html.span,childNodes:[t]}]}},buildHeader:function(e){return{nodeName:html.div,className:classes.windowHeader,childNodes:[{nodeName:html.a,className:classes.logo,text:sysName,attr:{href:directory.paths.website}},{nodeName:html.h2,className:classes.windowTitle,text:e}]}},buildButton:function(e,t){var s=classes.formBtnSubmit,i={type:types.button};return t&&(plib.isFunction(t)&&(t=t.call()),plib.hasProperty(t,attributes.className)&&(s=s+whiteSpace+t[attributes.className],delete t[attributes.className]),plib.isObjectEmpty(t)||plib.mergeObject(i,t)),{nodeName:html.button,className:s,childNodes:[{nodeName:html.span,childNodes:[{nodeName:html.span,text:e}]}],attr:i}},backToLogin:{nodeName:html.div,className:classes.formOptions,childNodes:[{nodeName:html.span,className:classes.formOption_backToLogin,text:"Back to Login"}]},logoutTab:[{nodeName:html.span,className:classes.windowLogout,text:"LOGOUT"},{nodeName:html.span,className:classes.windowUserName}],buildModal:function(e,t){return t=[{nodeName:html.a,className:classes.logo,attr:{href:directory.paths.website},text:sysName},{nodeName:html.h2,text:e}].concat(t),{nodeName:html.div,className:classes.modalMsg,childNodes:t}},simpleAdd:function(e,t){return{nodeName:e,text:t}}},layout={formTagCreate:commonHTML.buildForm(names.formCreate,commonHTML.logoutTab.concat([commonHTML.buildHeader("ADD NEW TAG"),commonHTML.buildFormInput(types.hidden,names.strWebReferer),commonHTML.buildFormInput(types.hidden,names.strImageURL),commonHTML.buildFormInput(types.hidden,names.nPosX),commonHTML.buildFormInput(types.hidden,names.nPosY),commonHTML.buildFormLabel("Tag name",commonHTML.buildFormInput(types.text,names.strTagName)),commonHTML.buildFormLabel("Keywords",commonHTML.buildFormInput(types.text,names.strKeywords)),commonHTML.buildFormLabel("Destination url",commonHTML.buildFormInput(types.text,names.strWebLink))]),"SAVE & PUBLISH TAG"),formRegister:commonHTML.buildForm(names.formRegister,[commonHTML.buildHeader("ACCOUNT REGISTRATION"),commonHTML.buildFormLabel("Full Name",commonHTML.buildFormInput(types.text,names.strFullName)),commonHTML.buildFormLabel("E-mail",commonHTML.buildFormInput(types.text,names.strUsername)),commonHTML.buildFormLabel("Password",commonHTML.buildFormInput(types.password,names.strPassword)),commonHTML.buildFormLabel("Confirm Pass",commonHTML.buildFormInput(types.password,names.strConfirmPass)),commonHTML.buildHeader("SITE REGISTRATION"),commonHTML.simpleAdd(html.p,"For "+sysName+" to work securely, it requires users to link their website to their account. Please provide us with some basic information about your website."),commonHTML.buildFormLabel("Website Name",commonHTML.buildFormInput(types.text,names.strWebName)),commonHTML.buildFormLabel("Website Domain",commonHTML.buildFormInput(types.text,names.strWebURL)),commonHTML.backToLogin],"REGISTER"),formLogin:commonHTML.buildForm(names.formLogin,[commonHTML.buildHeader("ACCOUNT LOGIN"),commonHTML.buildFormLabel("E-mail",commonHTML.buildFormInput(types.text,names.strUsername)),commonHTML.buildFormLabel("Password",commonHTML.buildFormInput(types.password,names.strPassword)),{nodeName:html.div,className:classes.formOptions,childNodes:[{nodeName:html.span,className:classes.formOption_forgotPass,text:"Forgot your password?"},{nodeName:html.span,className:classes.formOption_register,text:"Sign Up"}]}],"LOGIN"),formForgot:commonHTML.buildForm(names.formForgot,[commonHTML.buildHeader("FORGOT PASSWORD"),commonHTML.buildFormLabel("E-mail",commonHTML.buildFormInput(types.text,names.strUsername)),commonHTML.backToLogin],"RETRIEVE PASSWORD"),formSettings:commonHTML.buildForm(names.formSettings,commonHTML.logoutTab.concat([commonHTML.buildHeader("UPDATE SETTINGS"),commonHTML.simpleAdd(html.p,"This form allows administrators to change how "+sysName+" interacts with images. This form is not accessible to the public."),commonHTML.buildButton("REPOSITION TAGS",function(){var e={};return e[attributes.className]=classes.formBtnLeft,e[attributes.name]=names.btnRepositionTags,e}),commonHTML.buildButton("REMOVE TAGS",function(){var e={};return e[attributes.className]=classes.formBtnLeft,e[attributes.name]=names.btnRemoveTags,e}),commonHTML.buildButton("OPEN IMAGES IN LIGHTBOX",function(){var e={};return e[attributes.className]=classes.formBtnLeft,e[attributes.name]=names.btnOpenLightbox,e})])),msgTagDeleted:commonHTML.buildModal("This tag has been deleted.",[commonHTML.simpleAdd(html.p,"Note: because you are either the owner of the image, or the tags creator, you are able to delete it whereas the public would only be able to report.")]),msgForgot:commonHTML.buildModal("You have requested a new password.",[commonHTML.simpleAdd(html.p,"A new password has been generated and sent to your email address. We recommend that you change it asap!")]),msgRegistered:commonHTML.buildModal("Registration was successful.",[commonHTML.simpleAdd(html.p,"You have just created your account! Easy right? However there is one last step: your email needs to be authenticated. Please check your inbox for a confirmation email. If you do not receive an email within the hour, please contact our support team.")]),msgNoPermission:commonHTML.buildModal("You do not have sufficient permission.",[commonHTML.simpleAdd(html.p,"The owner of this website has requested your account not be able to add or request tags. Please contact the site owner for more information.")]),msgImageDisabled:commonHTML.buildModal("This image has been disabled.",[commonHTML.simpleAdd(html.p,"The "+sysName+" interface will no longer show on this image. If you wish the enable the interface, you can do so in the settings window.")]),msgImageEnabled:commonHTML.buildModal("This image has been enabled.",[commonHTML.simpleAdd(html.p,"The "+sysName+" interface will now show on this image. If you wish the disabled the interface, you can do so in the settings window.")]),msgFirstTag:commonHTML.buildModal("This appears to be your first tag!",[commonHTML.simpleAdd(html.p,"Luckily for you, we have made it as easy as possible. Here are some simple instructions to get you started."),{nodeName:html.ol,childNodes:[{nodeName:html.li,text:"Click on the image where you would like the tag to appear."},{nodeName:html.li,text:"A popup form will obtain some information relevant to the tag."},{nodeName:html.li,text:"Click save and you're off to the races."}]},commonHTML.buildButton("GREAT, LET'S GET STARTED")]),confirmPrompt:{nodeName:html.div,className:classes.prompt,childNodes:[commonHTML.buildHeader("PLEASE CONFIRM"),{nodeName:html.p,className:classes.promptMessage},commonHTML.buildButton("YES I DO",{class:classes.promptAccept}),commonHTML.buildButton("NO THANKS",{class:classes.promptDeny})]}},PinUi.prototype={init:function(){var e=this,t=plib.domAppend(html.div,e.scope.privateElements.imgOverlay,{class:classes.guiLeftHolder}),s=plib.domAppend(html.div,e.scope.privateElements.imgOverlay,{class:classes.guiRightHolder}),i=plib.domAppend(html.span,s,{class:classes.guiTopR+whiteSpace+classes.btnCancel});e.offsetLeft=plib.getWidth(t)-Math.abs(plib.getStyle(t,css.left)),e.offsetRight=10,plib.disableSelection(i),plib.addEvent(i,events.mouseover,function(){settings.animations?plib.animate(s,css.right,0,settings.navAniSpeed):plib.setStyle(s,css.right,0)}),plib.addEvent(i,events.mouseout,function(){settings.animations?plib.animate(s,css.right,-e.offsetRight,settings.navAniSpeed):plib.setStyle(s,css.right,-e.offsetRight)}),e.scope.privateElements.guiLeftHolder=t,e.scope.privateElements.guiRightHolder=s,e.scope.privateElements.btnCancel=i},ownerInit:function(){var e=this,t=plib.domAppend(html.span,e.scope.privateElements.imgOverlay,{class:classes.btnSettings});plib.setAlpha(t,opacities.semi),plib.addEvent(t,events.mouseover,function(){settings.animations?plib.fadeTo(t,opacities.full,settings.navAniSpeed):plib.setAlpha(t,opacities.full)}),plib.addEvent(t,events.mouseout,function(){settings.animations?plib.fadeTo(t,opacities.semi,settings.navAniSpeed):plib.setAlpha(t,opacities.semi)}),plib.click(t,function(){pfunc.promptSettings(e.scope.image)}),e.scope.privateElements.btnSettings=t},check:function(){var e=this;e.allowPrivateInterfaces=e.hasOwnerPrivileges(),e.hasUi||e.build()},build:function(){var e=this;plib.loopArray(e.leftNavItems,function(t){if(!t.isPrivate||e.allowPrivateInterfaces){var s=plib.domAppend(html.span,e.scope.privateElements.guiLeftHolder,{class:classes.guiBotL+whiteSpace+t.className},t.label);plib.disableSelection(s),pfunc.setFluidWidth(s),plib.addEvent(s,events.mouseover,function(){var t=plib.attribute(this,attributes.fluidWidth)-e.offsetLeft+5;settings.animations?plib.animate(this,css.left,t,settings.navAniSpeed):plib.setStyle(this,css.left,t)}),plib.addEvent(s,events.mouseout,function(){settings.animations?plib.animate(this,css.left,0,settings.navAniSpeed):plib.setStyle(this,css.left,0)}),plib.click(s,function(){t.event(e,s)})}}),e.allowPrivateInterfaces&&e.ownerInit(),e.hasUi=!0},destroy:function(){var e=this,t=plib.getElementsByClassName(classes.guiBotL,e.scope.privateElements.guiLeftHolder);t.length>0&&plib.loopArray(t,function(e){plib.removeElement(e)}),e.scope.privateElements.btnSettings&&plib.removeElement(e.scope.privateElements.btnSettings),e.hasUi=!1},enableCancelMode:function(e,t){var s=this,i=s.scope.privateElements.guiRightHolder,n=s.scope.privateElements.btnCancel,o=function(){s.disableCancelMode(t)};plib.click(n,o),pfunc.newKeyListener(keyCodes.esc,s.scope.pinUID,o),plib.textContent(n,e),plib.show(i),settings.animations&&plib.animate(i,css.right,-s.offsetRight,settings.navAniSpeed)},disableCancelMode:function(e){var t,s=this,i=s.scope.privateElements.guiRightHolder,n=s.scope.privateElements.btnCancel;plib.removeEvent(n,events.click),pfunc.removeKeyListener(keyCodes.esc,s.scope.pinUID),settings.animations?(t=pfunc.deactivateEvents(n,[events.mouseover,events.mouseout]),plib.animate(i,css.right,-plib.getWidth(i),settings.navAniSpeed,function(){pfunc.activateEvents(n,t),plib.hide(i),plib.removeChildren(n)})):(plib.hide(i),plib.removeChildren(n)),e&&e.call()},drawTooltip:function(e,t){var s,i,n,o=t.cornerRadius,a=t.pointerWidth,l=t.pointerHeight,r=t.canvasPadding,c=t.halfPixel,p=t.width,m=t.height,d=t.width-2*r-2*c,u=t.height-2*r-2*c,g=t.orientation,b=g===globalVars.tooltipOrientations.bottom?l:0,f=g===globalVars.tooltipOrientations.right?a:0,h=function(e){return Math.PI/180*e},v={top:l/2,right:a/2,bottom:l/2,left:a/2},y={topLeft:!0,topRight:!0,bottomLeft:!0,bottomRight:!0};g===globalVars.tooltipOrientations.top||g===globalVars.tooltipOrientations.bottom?(n=d/2,m+=l,t.offsetLeft<p/2?(n=t.offsetLeft-r,t.offsetLeft-r-o<a/2&&(v.left=0,y.topLeft=g!==globalVars.tooltipOrientations.bottom,y.bottomLeft=g!==globalVars.tooltipOrientations.top)):t.offsetRight<p/2&&(n=p-t.offsetRight-r,t.offsetRight-r-o<a/2&&(v.right=0,y.topRight=g!==globalVars.tooltipOrientations.bottom,y.bottomRight=g!==globalVars.tooltipOrientations.top))):g!==globalVars.tooltipOrientations.left&&g!==globalVars.tooltipOrientations.right||(n=u/2,p+=a),o<=0&&(y.topLeft=!1,y.topRight=!1,y.bottomLeft=!1,y.bottomRight=!1),e.width=p,e.height=m,plib.setWidth(e,p),plib.setHeight(e,m),(s=pfunc.getCanvasContext(e,"2d")).translate(r+f+c,r+b+c),s.beginPath(),y.topLeft?(s.moveTo(0,o),s.arc(o,o,o,h(180),h(270),!1)):s.moveTo(0,0),g===globalVars.tooltipOrientations.bottom&&(s.lineTo(n-v.left,0),s.lineTo(n,-l),s.lineTo(n+v.right,0)),y.topRight?(s.lineTo(d-o,0),s.arc(d-o,o,o,h(270),h(0),!1)):s.lineTo(d,0),g===globalVars.tooltipOrientations.left&&(s.lineTo(d,n-v.top),s.lineTo(d+a,n),s.lineTo(d,n+v.bottom)),y.bottomRight?(s.lineTo(d,u-o),s.arc(d-o,u-o,o,h(0),h(90),!1)):s.lineTo(d,u),g===globalVars.tooltipOrientations.top&&(s.lineTo(n+v.right,u),s.lineTo(n,u+l),s.lineTo(n-v.left,u)),y.bottomLeft?s.arc(o,u-o,o,h(90),h(180),!1):s.lineTo(0,u),g===globalVars.tooltipOrientations.right&&(s.lineTo(0,n+v.bottom),s.lineTo(-a,n),s.lineTo(0,n-v.top)),s.closePath(),t.allowShadow&&(s.shadowColor=t.theme.shadowColor,s.shadowOffsetX=t.theme.shadowOffsetX,s.shadowOffsetY=t.theme.shadowOffsetY,s.shadowBlur=t.theme.shadowBlur),t.theme.backgroundStyle===globalVars.canvasDrawStyles.radial?(i=s.createRadialGradient(d/2,u/2,0,d/2,u/2,d>u?d:u),plib.loopArray(t.theme.backgroundColor.split(" "),function(e){var t=e.split("-");i.addColorStop(t[0],t[1])})):t.theme.backgroundStyle===globalVars.canvasDrawStyles.linear?(i=s.createLinearGradient(d/2,0,d/2,u),plib.loopArray(t.theme.backgroundColor.split(" "),function(e){var t=e.split("-");i.addColorStop(t[0],t[1])})):t.theme.backgroundStyle===globalVars.canvasDrawStyles.solid&&(i=t.theme.backgroundColor),s.fillStyle=i,s.fill(),t.allowStroke&&(t.allowShadow&&(s.shadowColor=null,s.shadowOffsetX=null,s.shadowOffsetY=null,s.shadowBlur=null),s.strokeStyle=t.theme.strokeColor,s.lineWidth=t.theme.strokeWidth,s.stroke())},hasOwnerPrivileges:function(){return!!userInfo[serverKeys.user.isOwner]},show:function(e){var t=this,s=t.scope.privateElements.guiLeftHolder,i=t.scope.privateElements.btnSettings,n=t.offsetLeft-plib.getWidth(s);t.isHidden=!1,e=e||!0,settings.animations&&e?(plib.show(s),plib.animate(s,css.left,n,settings.navAniSpeed),i&&(plib.show(i),plib.fadeTo(i,opacities.semi,settings.navAniSpeed))):(plib.setStyle(s,css.left,n),i&&plib.show(i))},hide:function(e){var t=this,s=t.scope.privateElements.guiLeftHolder,i=t.scope.privateElements.btnSettings,n=-plib.getWidth(s),o=[];t.isHidden=!0,e=e||!0,settings.animations&&e?(i&&(o[0]=pfunc.deactivateEvents(i,[events.mouseover,events.mouseout]),plib.fadeOut(i,settings.navAniSpeed,function(){pfunc.activateEvents(i,o[0]),plib.hide(i)})),o[1]=pfunc.deactivateEvents(s,[events.mouseover,events.mouseout]),plib.animate(s,css.left,n,settings.navAniSpeed,function(){pfunc.activateEvents(s,o[1]),plib.hide(s)}),plib.loopArray(s.children,function(e){var t=o.length++;o[t]=pfunc.deactivateEvents(e,[events.mouseover,events.mouseout]),plib.animate(e,css.left,0,settings.navAniSpeed,function(){pfunc.activateEvents(e,o[t])})})):(plib.setStyle(s,css.left,n),i&&plib.hide(i))},toggle:function(e){this.isHidden?this.show(e):this.hide(e)}},PinInst.prototype={destroy:function(e){var t=this;e?plib.removeElement(t.privateElements.imgNode):plib.replaceElement(t.privateElements.imgNode,t.imageClone),delete cacheNodes[t.uid],delete cacheImages[t.uid],delete cacheTags[t.uid],pfunc.info(messages.imageUnloaded,t.uid)},init:function(){var e,t=this,s=plib.getComputedStyles(t.image),i=oNamespace.checkImage+t.imageCloneSrc;plib.attribute(t.image,attributes.imgLoaded,strBool[1]),plib.addClass(t.image,classes.image),t.privateElements.imgNode=plib.domWrap(html.div,t.image,{class:classes.node}),"inline"===s[css.display]&&plib.addClass(t.privateElements.imgNode,classes.inlineNode),cacheNodes[t.uid]={instance:t,imgGUID:plib.getGUID(t.image)},plib.click(t.privateElements.imgNode),t.settings.cssHelper&&t.styleHelper(s),plib.setWidth(t.image,t.dimensions.width),plib.setHeight(t.image,t.dimensions.height),plib.setStyle(t.image,css.maxWidth,t.dimensions.width),plib.setStyle(t.image,css.maxHeight,t.dimensions.height),plib.attribute(t.image,attributes.width,null),plib.attribute(t.image,attributes.height,null),plib.setWidth(t.privateElements.imgNode,t.dimensions.width),plib.setHeight(t.privateElements.imgNode,t.dimensions.height),t.settings.posHelper&&t.positionHelper(),t.privateElements.sectionBody=plib.domWrap(html.div,t.image,{class:classes.sectionBody}),plib.setWidth(t.privateElements.sectionBody,t.dimensions.width),plib.setHeight(t.privateElements.sectionBody,t.dimensions.height),t.privateElements.imgOverlay=plib.domAppend(html.div,t.privateElements.sectionBody,{class:classes.overlay}),plib.setWidth(t.privateElements.imgOverlay,t.dimensions.width),plib.setHeight(t.privateElements.imgOverlay,t.dimensions.height),t.privateElements.imgTagHolder=plib.domAppend(html.div,t.privateElements.imgOverlay,{class:classes.tagHolder}),t.preRun(),(e=pfunc.getLocalStorage(i))?(t.imageSrc=e,t.imageCloneSrc!==t.imageSrc&&pfunc.info(messages.imageNewSrc,t.imageCloneSrc,t.imageSrc),t.postRun()):plib.loadJSONP(directory.names.checkImage,{strImageURL:t.imageSrc},function(e){e&&(t.imageSrc=e,pfunc.info(messages.imageNewSrc,t.imageCloneSrc,t.imageSrc)),pfunc.setLocalStorage(i,t.imageSrc),t.postRun()})},positionHelper:function(){var e=this,t=plib.getCumulativeOffset(e.image),s="absolute"===plib.getStyle(e.privateElements.imgNode,css.position)?{top:css.top,left:css.left}:{top:css.margin.top,left:css.margin.left},i=plib.getStyle(e.privateElements.imgNode,s.left)||0,n=plib.getStyle(e.privateElements.imgNode,s.top)||0,o=e.dimensions.offsetLeft-t.x+i,a=e.dimensions.offsetTop-t.y+n;o>0&&(plib.setStyle(e.privateElements.imgNode,s.left,o),e.dimensions.offsetLeft=o),a>0&&(plib.setStyle(e.privateElements.imgNode,s.top,a),e.dimensions.offsetTop=a)},styleHelper:function(e){var t,s,i=this;delete e[css.display],"static"===e[css.position]&&delete e[css.position],plib.attribute(i.image,attributes.style,null),plib.attribute(i.image,attributes.align,null),plib.attribute(i.image,attributes.hspace,null),plib.attribute(i.image,attributes.vspace,null),t=plib.getComputedStyles(i.privateElements.imgNode),s=plib.getComputedStyles(i.image),plib.loopObject(e,function(e,n){if(!plib.inArray(["width","height","color"],e)){var o=t[e],a=s[e];n!==o&&plib.setStyle(i.privateElements.imgNode,e,n),a!==o&&plib.setStyle(i.image,e,o)}})},preRun:function(){var e=this;!0===e.settings.allowBottomLinks&&(e.privateElements.sectionFooter=plib.domAppend(html.div,e.privateElements.imgNode,{class:classes.sectionFooter}),e.privateElements.linkHolder=plib.domAppend(html.div,e.privateElements.sectionFooter,{class:classes.linkHolder}),plib.domAppend(html.div,e.privateElements.sectionFooter,{class:classes.linkHolderBackground}),plib.hide(e.privateElements.sectionFooter)),e.ui=new PinUi(e),e.ui.init(),plib.addEvent(e.privateElements.imgNode,events.mouseover,function(t){new pfunc.MouseBoundaryCrossing(t,this).enteredLandmark&&e.enableImgNode()}),plib.addEvent(e.privateElements.imgNode,events.mouseout,function(t){new pfunc.MouseBoundaryCrossing(t,this).leftLandmark&&e.disableImgNode()}),e.settings.alwaysShowTags&&plib.addClass(e.privateElements.imgNode,classes.actionOn)},postRun:function(){var e=this;pfunc.log(messages.instOutput,e),e.settings.alwaysShowTags&&pfunc.checkLogin(null,null,function(){pfunc.methodSessionChange(e)})},methodAddNewTag:function(e){var t=this;pfunc.openPrivateWindow(layout.formTagCreate,function(){var s=document.forms[names.formCreate];s.elements[names.strWebReferer].value=windowLocation,s.elements[names.strImageURL].value=t.imageSrc,s.elements[names.nPosX].value=e.x,s.elements[names.nPosY].value=e.y,pfunc.manageTagSuggestionList(s),pfunc.manageKeywords(s.elements[names.strKeywords]),pfunc.validWebUrl(s.elements[names.strWebLink]),pfunc.manageFormSubmit(s,directory.names.tagCreate,[asterisk],function(e){e?pfunc.displayFormError(this,e):(pfunc.closeWindow(),t.updateNode(!0,!0),userInfo[serverKeys.user.tagTotal]+=1)})})},updateNode:function(e,t){var s=this,i=function(){var e=cacheTagData[this.imageSrc][0],t=cacheTagData[this.imageSrc][1];this.tagsVersion=e,t&&!plib.isObjectEmpty(t)&&(this.drawTagData(t),this.settings.allowBottomLinks&&this.drawLinkData(t))};if(e|=!1,t|=!1,!0!==s.updateInProgress)if(s.updateInProgress=!0,t&&delete cacheTagData[s.imageSrc],plib.hasProperty(cacheTagData,s.imageSrc))(e||s.tagsVersion!==cacheTagData[s.imageSrc][0])&&i.call(s),s.updateInProgress=!1;else{if(plib.hasProperty(queueTagData,s.uid)||(queueTagData[s.uid]=[]),plib.inArray(queueTagData[s.uid],s)||queueTagData[s.uid].push(s),queueTagData[s.uid].length>1)return;plib.loadJSONP(directory.names.getTags,{strImageURL:s.imageSrc},function(e){null!==e&&(cacheTagData[s.imageSrc]=[(new Date).getTime(),e],plib.loopArray(queueTagData[s.uid],function(e){i.call(e)}),delete queueTagData[s.uid]),s.updateInProgress=!1})}},tagMouseoverEvent:function(e){var t,s,i=this,n=plib.getElementsByClassName(classes.tagDot,e)[0],o=plib.getElementsByClassName(classes.tagOutline,e)[0],a=plib.getElementsByClassName(classes.tagBubble,e)[0],l={};plib.attribute(e,attributes.tagHover,strBool[1]),plib.setStyle(e,css.zIndex,999),plib.setStyle(i.privateElements.imgTagHolder,css.zIndex,999),n&&o&&(plib.show(o),t=2*i.settings.dotOutlineSize+plib.getWidth(n),l[css.width]=t,l[css.height]=t,l[css.margin.top]=-Math.floor(t/2),l[css.margin.left]=-Math.floor(t/2),settings.animations?plib.animate(o,l,200):plib.setStyles(o,l)),a&&i.allowTagBubble&&plib.show(a),(s=pfunc.getTagGuidObject(e))&&plib.loadJSONP(directory.names.logTagHover,s)},tagMouseoutEvent:function(e){var t=this,s=plib.getElementsByClassName(classes.tagOutline,e)[0],i=plib.getElementsByClassName(classes.tagBubble,e)[0],n={};plib.attribute(e,attributes.tagHover,null),plib.setStyle(e,css.zIndex,1),plib.setStyle(t.privateElements.imgTagHolder,css.zIndex,1),s&&(n[css.width]=0,n[css.height]=0,n[css.margin.top]=0,n[css.margin.left]=0,settings.animations?plib.animate(s,n,600,function(){plib.hide(this)}):(plib.setStyles(s,n),plib.hide(s))),i&&plib.hide(i)},clearTagData:function(){plib.loopObjectKeys(cacheTagData,function(e){delete cacheTagData[e]})},drawTagData:function(e){var t=this,s=plib.isElementEmpty(t.privateElements.imgTagHolder);plib.removeChildren(t.privateElements.imgTagHolder),plib.setAlpha(t.privateElements.imgTagHolder,0),plib.loopObject(e,function(e){var s,i,n,o,a,l,r,c=e[0],p=plib.randomID(12),m=[];(l={})[attributes.id]=tagPrefix+t.uid+"-"+p,l[attributes.className]=classes.tag+whiteSpace+globalVars.availableDotSizes[settings.dotSize],l[attributes.tagPosX]=c[serverKeys.tags.posX],l[attributes.tagPosY]=c[serverKeys.tags.posY],e.length>1?(plib.loopObject(e,function(e){m.push(e[serverKeys.tags.guid])}),l[attributes.tagMultiGuid]=m.join("_")):l[attributes.tagGuid]=c[serverKeys.tags.guid],s=plib.domAppend(html.div,t.privateElements.imgTagHolder,l),plib.setStyle(s,css.left,String(100*c[serverKeys.tags.posX])+"%"),plib.setStyle(s,css.top,String(100*c[serverKeys.tags.posY])+"%"),(l={})[attributes.className]=classes.tagDot,i=plib.domAppend(html.a,s,l),pfunc.setWindowLink(i,directory.paths.webloc+c[serverKeys.tags.guid]),t.settings.dotOutlineSize>0&&((l={})[attributes.className]=classes.tagOutline,n=plib.domAppend(html.span,s,l),(r={})[css.width]=0,r[css.height]=0,r[css.margin.top]=0,r[css.margin.left]=0,plib.setStyles(n,r)),t.settings.tooltip&&(a=document.createDocumentFragment(),plib.hasProperty(cacheTags,t.uid)||(cacheTags[t.uid]={}),plib.loopArray(e,function(s,i){var n,o,r,c=i[serverKeys.tags.name],m=i[serverKeys.tags.keywords].join(),d=i[serverKeys.tags.webLink],u=i[serverKeys.tags.guid],g=i[serverKeys.tags.ownerGuid];cacheTags[t.uid][u]=p,(l={})[attributes.id]=tagPrefix+p+"-"+u,l[attributes.className]=classes.tagLink,l[attributes.tagGuid]=u,l[attributes.tagName]=c,l[attributes.tagKeywords]=m,l[attributes.tagWebLink]=d,l[attributes.tagOwnerId]=g,n=plib.domAppend(html.span,a,l),r=c.length>25?c.substr(0,25)+ellipsis:c,(l={})[attributes.className]=classes.tagLinkText,o=plib.domAppend(html.a,n,l,r),pfunc.setWindowLink(o,directory.paths.webloc+u),t.settings.tooltipURL&&(plib.loopArray(webProtos,function(e){d=d.replace(e,"")}),(d=d.replace(regex.tslash,"")).length>25&&(d=d.substr(0,25)+ellipsis),(l={})[attributes.className]=classes.tagLinkURL,plib.domAppend(html.span,n,l,d)),t.settings.allowShare&&((l={})[attributes.className]=classes.tagLinkLike,plib.click(plib.domAppend(html.span,n,l,"like"),function(){t.manageTagLike(this)}),plib.setStyle(n,css.padding.right,18)),s+1===e.length&&plib.addClass(n,classes.lastItem)}),o=t.drawTagBubble(s,a),plib.hide(o)),plib.loopObjectKeys(cacheTags,function(e){console.log(e)}),pfunc.isMobile()?plib.addEvent(s,events.touchend,function(){var e=plib.getParentByClassName(this,classes.tag);plib.stopBubble(),plib.attribute(e,attributes.tagHover)===strBool[1]?t.tagMouseoutEvent(e):t.tagMouseoverEvent(e)}):(plib.addEvent(s,events.mouseover,function(e){var s=plib.getParentByClassName(this,classes.tag);new pfunc.MouseBoundaryCrossing(e,this).enteredLandmark&&t.tagMouseoverEvent(s)}),plib.addEvent(s,events.mouseout,function(e){var s=plib.getParentByClassName(this,classes.tag);new pfunc.MouseBoundaryCrossing(e,this).leftLandmark&&t.tagMouseoutEvent(s)}))}),s?plib.fadeIn(t.privateElements.imgTagHolder,800):plib.setAlpha(t.privateElements.imgTagHolder,1)},drawTagBubble:function(e,t){var s,i,n,o,a=this,l=plib.getElementsByClassName(classes.tagDot,e)[0],r={},c={},p={},m=a.settings.tooltipOrientation;return n={},n[attributes.className]=classes.tagBubble,s=plib.domAppend(html.span,e,n),n={},n[attributes.className]=classes.tagBubbleContent,i=plib.domAppend(html.span,s,n),plib.domAppend(t,i),r.t=plib.getCumulativeOffset(e),r.th=plib.getCumulativeOffset(a.privateElements.imgTagHolder),c.halfPixel=a.settings.canvas.stroke&&a.settings.canvas.theme.strokeWidth%2!=0?.5:0,c.bubblePadding=3,c.bubbleDotDist=plib.getWidth(l)/2,c.tagBubbleWidth=plib.getWidth(s)+2*c.halfPixel,c.tagBubbleHeight=plib.getHeight(s)+2*c.halfPixel,c.tagHolderWidth=plib.getWidth(a.privateElements.imgTagHolder),c.tagHolderHeight=plib.getHeight(a.privateElements.imgTagHolder),c.tagBubbleContentHeight=plib.getHeight(i),c.tagOffsetTop=r.t.y-r.th.y,c.tagOffsetBottom=c.tagHolderHeight-c.tagOffsetTop,c.tagOffsetLeft=r.t.x-r.th.x,c.tagOffsetRight=c.tagHolderWidth-c.tagOffsetLeft,c.tailWidth=a.settings.canvas.tailWidth,c.tailHeight=a.settings.canvas.tailHeight,c.totalWidth=c.tagBubbleWidth,c.totalHeight=c.tagBubbleHeight,p[css.top]="auto",p[css.right]="auto",p[css.bottom]="auto",p[css.left]="auto",m===globalVars.tooltipOrientations.top||m===globalVars.tooltipOrientations.bottom?(p[css.left]=-c.tagBubbleWidth/2,c.totalHeight+=c.tailHeight):m!==globalVars.tooltipOrientations.left&&m!==globalVars.tooltipOrientations.right||(c.tailWidth=a.settings.canvas.tailHeight,c.tailHeight=a.settings.canvas.tailWidth,p[css.top]=-c.tagBubbleHeight/2,c.totalWidth+=c.tailWidth),m===globalVars.tooltipOrientations.top?c.totalHeight+c.bubbleDotDist>c.tagOffsetTop&&(m=globalVars.tooltipOrientations.bottom):m===globalVars.tooltipOrientations.right?c.totalWidth+c.bubbleDotDist>c.tagOffsetRight&&(m=globalVars.tooltipOrientations.left):m===globalVars.tooltipOrientations.bottom?c.totalHeight+c.bubbleDotDist>c.tagOffsetBottom&&(m=globalVars.tooltipOrientations.top):m===globalVars.tooltipOrientations.left&&c.totalWidth+c.bubbleDotDist>c.tagOffsetLeft&&(m=globalVars.tooltipOrientations.right),m===globalVars.tooltipOrientations.top?p[css.bottom]=c.bubbleDotDist:m===globalVars.tooltipOrientations.right?(p[css.left]=c.bubbleDotDist+1,plib.setStyle(i,css.padding.left,10+c.tailWidth)):m===globalVars.tooltipOrientations.bottom?(p[css.top]=c.bubbleDotDist+1,plib.setStyle(i,css.top,c.totalHeight-c.tagBubbleContentHeight)):m===globalVars.tooltipOrientations.left&&(p[css.right]=c.bubbleDotDist,plib.setStyle(i,css.padding.right,10+c.tailWidth)),m!==globalVars.tooltipOrientations.top&&m!==globalVars.tooltipOrientations.bottom||(c.tagOffsetLeft<c.tagBubbleWidth/2?p[css.left]=-c.tagOffsetLeft:c.tagOffsetRight<c.tagBubbleWidth/2&&(p[css.left]=-(c.tagBubbleWidth-c.tagOffsetRight))),plib.setStyles(s,p),plib.setWidth(s,c.totalWidth),plib.setHeight(s,c.totalHeight),plib.runInterval(30,30,function(){return support.canvas},function(){(n={})[attributes.className]=classes.tagBubbleCanvas,(o=plib.domAppend(html.canvas,s,n)).pinupCanvasProperties={theme:a.settings.canvas.theme,allowStroke:a.settings.canvas.stroke,allowShadow:a.settings.canvas.shadow,cornerRadius:a.settings.canvas.cornerRadius,canvasPadding:c.bubblePadding,halfPixel:c.halfPixel,width:c.tagBubbleWidth,height:c.tagBubbleHeight,offsetLeft:c.tagOffsetLeft,offsetRight:c.tagOffsetRight,pointerWidth:c.tailWidth,pointerHeight:c.tailHeight,orientation:m},a.ui.drawTooltip(o,o.pinupCanvasProperties)},function(){}),s},drawLinkData:function(e){var t=this,s=t.privateElements.linkHolder,i=function(){var e=plib.attribute(this,attributes.tagGuid);plib.hasProperty(cacheTags,t.uid)&&plib.hasProperty(cacheTags[t.uid],e)&&t.tagMouseoverEvent(document.getElementById(tagPrefix+t.uid+"-"+cacheTags[t.uid][e]))},n=function(){plib.loopArray(plib.getElementsByClassName(classes.tag,t.privateElements.imgTagHolder),function(e){t.tagMouseoutEvent(e)})};plib.removeChildren(s),plib.loopObject(e,function(e){plib.loopArray(e,function(e){var o,a;(a={})[attributes.className]=classes.link,a[attributes.tagGuid]=e[serverKeys.tags.guid],o=plib.domAppend(html.a,s,a),pfunc.setWindowLink(o,directory.paths.webloc+e[serverKeys.tags.guid]),(a={})[attributes.className]=classes.iconLabel,plib.domAppend(html.span,o,a),plib.appendText(o,e[serverKeys.tags.name]),t.settings.tooltip&&(plib.addEvent(o,events.mouseover,i),plib.addEvent(o,events.mouseout,n))})}),plib.isElementEmpty(s)?(plib.hide(t.privateElements.sectionFooter),plib.hide(s),plib.setHeight(t.privateElements.imgNode,t.dimensions.height)):(plib.show(t.privateElements.sectionFooter),plib.show(s),plib.setHeight(t.privateElements.imgNode,plib.getHeight(s)+t.dimensions.height))},enableImgNode:function(){var e=this;e.disallowNodeUpdate||(e.settings.alwaysShowTags||plib.addClass(e.privateElements.imgNode,classes.actionOn),pfunc.checkLogin(null,null,function(){pfunc.methodSessionChange(e)}),pfunc.newKeyListener(keyCodes.f2,e.uid,function(){e.ui.toggle()}))},disableImgNode:function(){var e=this;e.disallowNodeUpdate||(e.settings.alwaysShowTags||plib.removeClass(e.privateElements.imgNode,classes.actionOn),pfunc.removeKeyListener(keyCodes.f2,e.uid))},resetTagDotBehavior:function(){var e=this;plib.loopArray(plib.getElementsByClassName(classes.tagDot,e.privateElements.imgTagHolder),function(e){var t=pfunc.getTagGuidObject(e.parentNode),s=t?plib.hasProperty(t,"tagGUID")?t.tagGUID:plib.hasProperty(t,"tagMultiGUID")?t.tagMultiGUID.split("_")[0]:void 0:void 0;plib.removeAllEvents(e),s&&pfunc.setWindowLink(e,directory.paths.webloc+s)})},stopTaggingMode:function(){var e=this;e.disallowNodeUpdate=!1,e.allowTagBubble=!0,plib.removeEvent(e.privateElements.imgTagHolder,events.click),plib.removeClass(e.privateElements.imgTagHolder,classes.button),e.resetTagDotBehavior(),e.ui.show(),e.ui.disableCancelMode(),plib.removeClass(e.privateElements.imgNode,classes.taggingMode),plib.hasClass(globalElements.pInstWrapper,classes.actionShowWin)||plib.addClass(e.privateElements.imgNode,classes.actionOn)},startTaggingMode:function(e){var t=this;pfunc.checkPermission(function(){t.disallowNodeUpdate=!0,t.allowTagBubble=!1,plib.removeClass(t.privateElements.imgNode,classes.actionOn),plib.addClass(t.privateElements.imgNode,classes.taggingMode),plib.click(t.privateElements.imgTagHolder,function(s){t.stopTaggingMode(),e&&e.call(t,pfunc.getPosPercentage(s))},!0),plib.loopArray(plib.getElementsByClassName(classes.tagDot,t.privateElements.imgTagHolder),function(s){plib.removeAllEvents(s),plib.click(s,function(){t.stopTaggingMode(),e&&e.call(t,{x:plib.attribute(this.parentNode,attributes.tagPosX),y:plib.attribute(this.parentNode,attributes.tagPosY)})},!0)}),t.ui.hide(),t.ui.enableCancelMode("CANCEL",function(){t.stopTaggingMode()})})},stopTagRepositionMode:function(){var e=this;e.disallowNodeUpdate=!1,e.allowTagBubble=!0,plib.hasEvent(document,events.mouseup)&&(plib.fireEvent(document,events.mouseup),plib.removeEvent(document,events.mouseup),plib.removeClass(e.privateElements.imgNode,classes.handOver)),e.resetTagDotBehavior(),e.ui.show(),e.ui.disableCancelMode(),plib.removeClass(e.privateElements.imgNode,classes.repositionMode),plib.addClass(e.privateElements.imgNode,classes.actionOn)},startTagRepositionMode:function(){var e=this;pfunc.checkPermission(function(){e.disallowNodeUpdate=!0,e.allowTagBubble=!1,plib.removeClass(e.privateElements.imgNode,classes.actionOn),plib.addClass(e.privateElements.imgNode,classes.repositionMode),plib.loopArray(plib.getElementsByClassName(classes.tag,e.privateElements.imgTagHolder),function(t){var s=plib.getElementsByClassName(classes.tagDot,t)[0];plib.removeAllEvents(s),plib.addEvent(s,events.mouseover,function(){plib.addClass(e.privateElements.imgNode,classes.handOver)}),plib.addEvent(s,events.mouseout,function(){plib.removeClass(e.privateElements.imgNode,classes.handOver)}),plib.addEvent(s,events.mousedown,function(i){plib.stopBubble(i),plib.addClass(e.privateElements.imgNode,classes.handDrag),pfunc.startDragging(t),plib.addEvent(document,events.mouseup,function(){var i=pfunc.getTagGuidObject(s.parentNode);i&&(plib.removeClass(e.privateElements.imgNode,classes.handDrag),pfunc.stopDragging(t),plib.removeEvent(document,events.mouseup),i[serverKeys.tags.imagePath]=e.imageSrc,i[serverKeys.tags.posX]=plib.attribute(t,attributes.tagPosX),i[serverKeys.tags.posY]=plib.attribute(t,attributes.tagPosY),plib.loadJSONP(directory.names.tagPosition,i,e.clearTagData))})})}),e.ui.hide(),e.ui.enableCancelMode("DONE",function(){e.stopTagRepositionMode()})})},stopTagRemovalMode:function(){var e=this;e.disallowNodeUpdate=!1,e.allowTagBubble=!0,e.resetTagDotBehavior(),e.ui.show(),e.ui.disableCancelMode(),plib.removeClass(e.privateElements.imgNode,classes.removalMode),plib.addClass(e.privateElements.imgNode,classes.actionOn)},startTagRemovalMode:function(){var e=this;pfunc.checkPermission(function(){e.disallowNodeUpdate=!0,e.allowTagBubble=!1,plib.removeClass(e.privateElements.imgNode,classes.actionOn),plib.addClass(e.privateElements.imgNode,classes.removalMode),plib.loopArray(plib.getElementsByClassName(classes.tag,e.privateElements.imgTagHolder),function(t){var s=plib.getElementsByClassName(classes.tagDot,t)[0];plib.removeAllEvents(s),plib.click(s,function(){var t=plib.getElementsByClassName(classes.tagBubbleContent,s.parentNode)[0].children.length>1?messages.removeMultiTags:messages.removeTag;pfunc.promptConfirm(t,function(){var t=pfunc.getTagGuidObject(s.parentNode);t&&plib.loadJSONP(directory.names.tagRemove,t,function(i){plib.isUndefined(i)&&(pfunc.closeWindow(),plib.removeElement(s.parentNode),settings.allowBottomLinks&&(plib.hasProperty(t,"tagGUID")?plib.loopArray(e.privateElements.linkHolder.children,function(e){if(plib.attribute(e,attributes.tagGuid)===t.tagGUID)return plib.removeElement(e),null}):plib.hasProperty(t,"tagMultiGUID")&&plib.loopArray(t.tagMultiGUID.split("_"),function(t){plib.loopArray(e.privateElements.linkHolder.children,function(e){if(plib.attribute(e,attributes.tagGuid)===t)return plib.removeElement(e),null})})),e.clearTagData())})})})}),e.ui.hide(),e.ui.enableCancelMode("DONE",function(){e.stopTagRemovalMode()})})},manageTagLike:function(e){var t,s,i,n=this,o=plib.getParentByClassName(e,classes.tag),a=plib.getParentByClassName(e,classes.tagLink),l=plib.getElementsByClassName(classes.tagBubble,o)[0],r=plib.attribute(a,attributes.tagName),c=plib.attribute(a,attributes.tagWebLink);(i={})[attributes.className]=classes.shareHolder,t=plib.newElement(html.div,i),(i={})[attributes.className]=classes.shareHeader,plib.domAppend(html.span,t,i,"SHARE THIS ON"),(i={})[attributes.className]=classes.shareButtons,s=plib.domAppend(html.div,t,i),(i={})[attributes.className]=classes.shareButton+whiteSpace+"st_twitter_large",i[attributes.href]=directory.paths.twitter+plib.getParamsFromObject({text:r+" found at ",url:encodeURI(c)}),plib.click(plib.domAppend(html.a,s,i),function(){pfunc.openPopupWindow(plib.attribute(this,attributes.href),480,400)}),(i={})[attributes.className]=classes.shareButton+whiteSpace+"st_facebook_large",i[attributes.href]=directory.paths.facebook+plib.getParamsFromObject({u:encodeURI(c),t:encodeURIComponent(r)}),plib.click(plib.domAppend(html.a,s,i),function(){pfunc.openPopupWindow(plib.attribute(this,attributes.href),1e3,640)}),n.updateInProgress=!0,plib.removeElement(l),l=n.drawTagBubble(o,t),plib.removeEvent(o,events.mouseout),plib.addEvent(o,events.mouseout,function(e){new pfunc.MouseBoundaryCrossing(e,this).leftLandmark&&(n.updateInProgress=!1,n.updateNode(!0))})}},pfunc={systemStart:function(){var e=document.getElementById(sysName+"SEO"),t=function(){clearTimeout(scrollMem),scrollMem=setTimeout(function(){plib.isObjectEmpty(hiddenImages)?settings.forceListen||(plib.removeEvent(document,support.propertychange),plib.removeEvent(document,events.scroll)):plib.loopObject(hiddenImages,function(e){pfunc.loadImage(e.image)}),settings.forceListen&&pfunc.checkForImages()},settings.scrollDelay)};if(alive)pfunc.warn(messages.alreadyAlive);else{for(alive=!0,stats={nImagesFound:0,nImagesLoaded:0,nImagesDenied:0},settings.custom&&!plib.isObjectEmpty(settings.custom)&&plib.hasProperty(settings.custom,document.body.id)&&pfunc.updateSettings(settings.custom[document.body.id]),pfunc.initKeyListener(),pfunc.checkSupport(),plib.isElement(e)&&(globalElements.pseudoSEO=e),globalElements.pInstActive=plib.newElement(html.div,{id:classes.docBody,class:classes.docBody});document.body.firstChild;)globalElements.pInstActive.appendChild(document.body.firstChild);document.body.appendChild(globalElements.pInstActive),settings.animations||plib.addClass(globalElements.pInstActive,classes.noAnimation),support.rgba||plib.addClass(globalElements.pInstActive,classes.noRgbaSupport),support.boxShadow||plib.addClass(globalElements.pInstActive,classes.noBoxShadowSupport),support.borderRadius||plib.addClass(globalElements.pInstActive,classes.noBorderRadiusSupport),support.canvas||plib.isUndefined(window[oNamespace.vmlCanvas])&&(pfunc.info(messages.excanvasRequest),plib.loadScript(directory.paths.excanvas,function(){window[oNamespace.vmlCanvas].init_(document),support.canvas=pfunc.getCanvasContext(document.createElement(html.canvas)),pfunc.info(messages.excanvasReceived,support.canvas?"now supported":"still not supported")})),globalElements.pInstWrapper=plib.domAppend(html.div,globalElements.pInstActive,{class:classes.wrapper}),settings.allowThemeManager&&pfunc.manageTheme(settings.themeFile),globalElements.pInstWindow=plib.domAppend(html.div,globalElements.pInstWrapper,{class:classes.window}),globalElements.pInstWindowOverlay=plib.domAppend(html.div,globalElements.pInstWrapper,{class:classes.windowOverlay}),globalElements.pInstWindowClose=plib.domAppend(html.span,globalElements.pInstWindow,{class:classes.windowClose},"close"),globalElements.pInstWindowBody=plib.domAppend(html.div,globalElements.pInstWindow,{class:classes.windowBody}),globalElements.pInstWindowBackground=plib.domAppend(html.div,globalElements.pInstWindow,{class:classes.windowBackground}),plib.click(globalElements.pInstWindowOverlay,pfunc.closeWindow),plib.click(globalElements.pInstWindowClose,pfunc.closeWindow),pfunc.checkLogin(null,null,function(){pfunc.checkForImages(),(settings.smartLoad&&!plib.isObjectEmpty(hiddenImages)||settings.forceListen)&&(plib.addEvent(document,support.propertychange,t),plib.addEvent(document,events.scroll,t)),0===stats.nImagesLoaded&&pfunc.info(messages.noImages),settings.onReady&&settings.onReady.call(window[oNamespace.root]),pfunc.timeEnd(messages.sysLoadTime)})}},systemStop:function(){if(alive){for(alive=!1,plib.loopObject(cacheNodes,function(e){e.instance.destroy()}),plib.removeElement(globalElements.pInstWrapper);globalElements.pInstActive.hasChildNodes();)globalElements.pInstActive.parentNode.insertBefore(globalElements.pInstActive.firstChild,globalElements.pInstActive);plib.removeElement(globalElements.pInstActive),plib.loopObject(cacheEvents,function(e){plib.loopObject(e,function(e,t){plib.removeEvent(t.element,e)})}),globalElements={},globalKeyEvents={},cacheImages={},cacheNodes={},cacheTags={},cacheTagData={},cacheEvents={},cacheElements={},queueTagData={},jsonpHandler={},jsonpTimeout={},userInfo={},support={},hiddenImages={},stats={},settings=plib.cloneObject(defaultSettings),pfunc.updateWindowNamespace(),nLastLoginCheck=0,pfunc.info(messages.sysDestroyed)}else pfunc.warn(messages.alreadyDead)},updateWindowNamespace:function(e,t){var s={},i=function(e,t){window[oNamespace.root][e]=t,window[oNamespace.root].prototype[e]=t};e&&t?i(e,t):(i(oNamespace.globalVars,globalVars),i(oNamespace.settings,settings),i(oNamespace.defaultSettings,defaultSettings),i(oNamespace.user,userInfo),i(oNamespace.json,jsonpHandler),i(oNamespace.lib,plib),plib.loopObject({systemStart:pfunc.systemStart,systemStop:pfunc.systemStop,updateSettings:pfunc.updateSettings,loadImage:pfunc.loadImage,unLoadImage:pfunc.unLoadImage,checkForImages:pfunc.checkForImages,promptRegister:pfunc.promptRegister,promptLogin:pfunc.promptLogin,promptLogout:pfunc.promptLogout,promptAddTag:pfunc.promptAddTag,promptSettings:pfunc.promptSettings,promptOpenLightbox:pfunc.promptOpenLightbox,changeTheme:pfunc.changeTheme},function(e,t){s[e]=t}),i(oNamespace.fn,s),i(oNamespace.images,cacheImages),i(oNamespace.nodes,cacheNodes),i(oNamespace.tags,cacheTags),i(oNamespace.events,cacheEvents),i(oNamespace.elements,cacheElements))},onImageDimensionReady:function(e,t){function s(){var s={},i=function(){return s.width=plib.getWidth(e),s.height=plib.getHeight(e),0!==s.width&&0!==s.height};!0===i()?t.call(e,s):plib.runInterval(10,100,i,function(){t.call(e,s)})}e.complete?s():plib.addEvent(e,events.load,s)},cacheImage:function(e){var t;e.pinUID||(t=plib.randomID(10),cacheImages[t]={loaded:!1,image:e,offset:plib.getCumulativeOffset(e)},e.pinUID=t)},checkForImages:function(e){function t(e){plib.loopArray(e.getElementsByTagName(html.img),function(e){pfunc.cacheImage(e)})}alive?(settings.loadAll?(e=e||document,plib.isElement(e)||e===document?t(e):plib.isArray(e)&&plib.loopArray(e,function(e){t(e)})):(plib.loopArray(plib.getElementsByClassName(settings.activeChildClass),function(e){pfunc.cacheImage(e)}),plib.loopArray(plib.getElementsByClassName(settings.activeParentClass),function(e){plib.loopArray(e.getElementsByTagName(html.img),function(e){pfunc.cacheImage(e)})}),settings.loadImages.length>0&&plib.loopArray(settings.loadImages,function(e){pfunc.cacheImage(e)})),plib.loopObject(cacheImages,function(e){e.loaded||pfunc.loadImage(e.image)}),pfunc.info(messages.imageCount,stats.nImagesFound,stats.nImagesLoaded,stats.nImagesDenied)):pfunc.warn(messages.sysNotActive)},unLoadImage:function(e,t){t=t||!1,pfunc.manageUserInputImage(e,function(e){e.destroy(t)}),delete cacheImages[e.pinUID]},loadImage:function(e){alive?(stats.nImagesFound++,pfunc.verifyImageReference(e,function(e){var t,s=plib.attribute(e,attributes.src),i=plib.getFileExtension(s),n=!0;e.pinUID||pfunc.cacheImage(e),t=plib.hasProperty(hiddenImages,e.pinUID)?hiddenImages[e.pinUID]:new PinInst(e,e.pinUID),plib.attribute(e,attributes.imgLoaded)===strBool[1]?(pfunc.warn(messages.badInstance),n=!1):s&&""!==plib.stripSpaces(s)?plib.inArray(settings.allowFile.split("|"),i)?plib.isElementIn(e,document)?globalElements.pseudoSEO&&plib.isElementIn(e,globalElements.pseudoSEO)&&(pfunc.warn(messages.imageIgnoreSEO,e),n=!1):(pfunc.warn(messages.imageNotFound,e),n=!1):(pfunc.warn(messages.imageBadFile,i,e),n=!1):(pfunc.warn(messages.imageNoSrc,e),n=!1),n?pfunc.onImageDimensionReady(e,function(s){if(s.width<settings.nMinWidth||s.height<settings.nMinHeight)pfunc.warn(messages.imageTooSmall,s.width,settings.nMinWidth,s.height,settings.nMinHeight,this);else{if(settings.smartLoad){if(pfunc.isHidden(this))return void(hiddenImages[this.pinUID]=t);plib.hasProperty(hiddenImages,this.pinUID)&&delete hiddenImages[this.pinUID]}stats.nImagesLoaded++,cacheImages[this.pinUID].loaded=!0,pfunc.info(messages.imageLoaded,this),t.settings=plib.cloneObject(settings),settings.custom&&!plib.isObjectEmpty(settings.custom)&&plib.hasProperty(settings.custom,e.id)&&pfunc.mergeStrictObjects(t.settings,settings.custom[e.id]),delete t.settings.custom,t.init()}}):stats.nImagesDenied++})):pfunc.warn(messages.sysNotActive)},mergeStrictObjects:function(e,t){plib.loopObject(t,function(t,s){var i,n;if(plib.hasProperty(e,t)){if(i=plib.type(e[t]),n=plib.type(s),i!==n)return void pfunc.warn(messages.badType,t,i,n);plib.isObject(s)?plib.isObjectEmpty(e[t])?e[t]=s:pfunc.mergeStrictObjects(e[t],s):e[t]=s}plib.hasProperty(e,t)||pfunc.warn(messages.settingDNF,t)})},updateSettings:function(e){pfunc.mergeStrictObjects(settings,e)},initKeyListener:function(){settings.keyListener&&plib.addEvent(document,events.keyup,function(e){var t=e.charCode||e.keyCode;plib.hasProperty(globalKeyEvents,t)&&plib.loopObject(globalKeyEvents[t],function(e){e(t)})})},newKeyListener:function(e,t,s){settings.keyListener&&(plib.isElement(t)&&(t=plib.getGUID(t)),globalKeyEvents[e]||(globalKeyEvents[e]={}),t&&(globalKeyEvents[e][t]=s))},removeKeyListener:function(e,t){settings.keyListener&&globalKeyEvents[e]&&(plib.isElement(t)&&(t=plib.getGUID(t)),globalKeyEvents[e][t]&&delete globalKeyEvents[e][t],plib.isObjectEmpty(globalKeyEvents[e])&&delete globalKeyEvents[e])},removeAllKeyListeners:function(e){settings.keyListener&&plib.loopObject(globalKeyEvents,function(t,s){s[e]&&pfunc.removeKeyListener(t,e)})},centerHorizontal:function(e){var t=plib.getWidth(e),s="-"+String(t/2)+cssUnit;plib.setStyle(e,css.margin.left,s)},centerVertical:function(e){var t=plib.getHeight(e),s="-"+String(t/2)+cssUnit;plib.setStyle(e,css.margin.top,s)},openWindow:function(e,t){plib.replaceHTML(globalElements.pInstWindowBody,e),plib.addClass(globalElements.pInstWrapper,classes.actionShowWin),pfunc.centerVertical(globalElements.pInstWindow),pfunc.newKeyListener(keyCodes.esc,globalElements.pInstWindow,function(){pfunc.closeWindow()}),t&&t.call(globalElements.pInstWindow)},openPrivateWindow:function(e,t){var s=function(){pfunc.openWindow(e,function(){var e=plib.getElementsByClassName(classes.windowUserName,this)[0];plib.domAppend(html.span,e,"Logged in as: "),plib.appendText(e,userInfo[serverKeys.user.fullName]),plib.click(plib.getElementsByClassName(classes.windowLogout,this)[0],function(){pfunc.closeWindow(),pfunc.promptLogout()}),t&&t.call(this)})};pfunc.checkLogin(function(){s()},function(){pfunc.promptLogin(function(){s()})})},closeWindow:function(){pfunc.removeKeyListener(keyCodes.esc,globalElements.pInstWindow),plib.removeClass(globalElements.pInstWrapper,classes.actionShowWin),plib.removeChildren(globalElements.pInstWindowBody)},promptConfirm:function(e,t){pfunc.openWindow(layout.confirmPrompt,function(){var s=plib.getElementsByClassName(classes.promptAccept,this)[0],i=plib.getElementsByClassName(classes.promptDeny,this)[0];plib.appendText(plib.getElementsByClassName(classes.promptMessage,this)[0],e),plib.click(s,function(){pfunc.waitButton(this,messages.formWait),plib.removeElement(i),t()}),plib.click(i,function(){pfunc.closeWindow()})})},setWindowLink:function(e,t,s){s=s||"_self",plib.click(e,function(){window.open(t,s).focus()}),plib.attribute(e,attributes.href,t)},openPopupWindow:function(e,t,s){var i,n=window.innerWidth||document.documentElement.clientWidth||0,o=window.innerHeight||document.documentElement.clientHeight||0,a=(window.screenLeft||window.screenX||0)+n/2-t/2,l=(window.screenTop||window.screenY||0)+o/2-s/2,r=[];return plib.loopObject({toolbar:0,scrollbars:0,location:1,statusbar:0,menubar:0,resizable:1,width:t,height:s,left:Math.abs(a),top:Math.abs(l)},function(e,t){r[r.length]=e+"="+t}),i=window.open(e,plib.randomID(8),r.join(",")),window.focus&&i.focus(),i},updateUserInfo:function(e){null===e?plib.loopObjectKeys(userInfo,function(e){delete userInfo[e]}):plib.mergeObject(userInfo,e)},checkLogin:function(e,t,s){var i=(new Date).getTime(),n=i-nLastLoginCheck,o=function(i){plib.isObjectEmpty(i)?(userLogged=!1,t&&t()):(userLogged=!0,e&&e()),s&&s()};0===nLastLoginCheck||n>6e4?(nLastLoginCheck=i,plib.loadJSONP(directory.names.checkLogin,function(e){pfunc.updateUserInfo(e),o(e)})):o(userInfo)},checkPermission:function(e){userInfo[serverKeys.user.isOwner]?e&&e():pfunc.openWindow(layout.msgNoPermission)},waitButton:function(e,t){var s=pfunc.deactivateEvents(e,[events.mouseover,events.mouseout]);plib.isObjectEmpty(s)||(e.oEventMemory=s),t&&(plib.attribute(e,attributes.orgText,plib.textContentRecursive(e)),plib.textContentRecursive(e,t))},unwaitButton:function(e){plib.textContentRecursive(e,plib.attribute(e,attributes.orgText)),plib.attribute(e,attributes.orgText,null),e.oEventMemory&&(pfunc.activateEvents(e,e.oEventMemory),delete e.oEventMemory)},deactivateEvents:function(e,t){var s=plib.getGUID(e),i={};return plib.loopArray(t,function(t){cacheEvents[s]&&cacheEvents[s][t]&&(i[t]=cacheEvents[s][t].handler,plib.removeEvent(e,t))}),i},activateEvents:function(e,t){plib.loopObject(t,function(t,s){plib.addEvent(e,t,s)})},MouseBoundaryCrossing:function(e,t){var s,i,n=(e=e||window.event).type;if(this.inLandmark=!1,this.leftLandmark=!1,this.enteredLandmark=!1,n===events.mouseout?(this.toElement=e.relatedTarget||e.toElement,this.fromElement=e.target||e.srcElement):n===events.mouseover&&(this.toElement=e.target||e.srcElement,this.fromElement=e.relatedTarget||e.fromElement),this.toElement&&this.fromElement){for(s=this.fromElement;plib.isElement(s)&&s!==t;)s=s.parentNode;for(i=this.toElement;plib.isElement(i)&&i!==t;)i=i.parentNode;s===t&&i===t?this.inLandmark=!0:s===t&&i!==t?(this.leftLandmark=!0,this.inLandmark=n===events.mouseout):s!==t&&i===t&&(this.enteredLandmark=!0,this.inLandmark=n===events.mouseover)}else pfunc.warn(messages.badTarget)},isHidden:function(e){var t,s,i,n,o,a,l=plib.getCumulativeOffset(e),r=plib.getWidth(e),c=plib.getHeight(e),p=window.pageXOffset||document.documentElement.scrollLeft,m=window.pageYOffset||document.documentElement.scrollTop,d=window.innerWidth||document.documentElement.offsetWidth,u=window.innerHeight||document.documentElement.offsetHeight;return function(e,t){do{if(t(e))break;e=e.offsetParent}while(e)}(e,function(e){if("fixed"===plib.getStyle(e,css.position).toLowerCase())return o=e,null}),o&&(p=(a=plib.getCumulativeOffset(o)).x,m=a.y),t=l.x-p+r<0,s=l.x>d+p,i=l.y-m+c<0,n=l.y>u+m,!!(t||s||i||n||r<0||c<0)||!plib.isVisible(e)},getPosPercentage:function(e){var t=plib.getEventTarget(e),s=plib.getMousePosition(e),i=plib.getCumulativeOffset(t);return{x:((s.x-i.x)/plib.getWidth(t)).toFixed(10),y:((s.y-i.y)/plib.getHeight(t)).toFixed(10)}},manageKeywords:function(e){plib.addEvent(e,events.change,function(){var e=this.value.replace(regex.ltrim,"").replace(regex.rtrim,"").split(regex.csv);this.value=plib.arrayUnique(e).slice(0,10).join(", ").toLowerCase()})},loopFormFields:function(e,t){plib.loopArray(e.elements,function(e){var s=e.nodeName.toLowerCase();if(s===html.input||s===html.textarea||s===html.select)return t.call(e)})},manageFormSubmit:function(e,t,s,i,n){plib.click(plib.getElementsByClassName(classes.formBtnSubmit,e)[0],function(){plib.fireEvent(e,events.submit)}),pfunc.loopFormFields(e,function(){plib.addEvent(this,events.focus,function(){plib.addClass(this.parentNode,classes.focus)}),plib.addEvent(this,events.blur,function(){plib.removeClass(this.parentNode,classes.focus)})}),pfunc.formFocus(e),pfunc.newKeyListener(keyCodes.enter,e,function(){plib.fireEvent(e,events.submit)}),plib.addEvent(e,events.submit,function(o){var a,l;if(plib.stopBubble(o),a=pfunc.getFormData(e),pfunc.checkRequired(e,s)){if(n&&(l=n.call(e,a)))return pfunc.displayFormError(e,l),!1;pfunc.disableForm(e),plib.loadJSONP(t,a,function(t){pfunc.enableForm(e),i.call(e,t)})}})},getFormData:function(e){var t={};return plib.loopArray(e.elements,function(e){e.value!==monetarySymbol&&e.value!==defaultWebProto||(e.value=""),e.name&&e.value&&(t[e.name]=e.value)}),t},displayFormError:function(e,t){var s=plib.getElementsByClassName(classes.formError,e)[0];t?(plib.replaceHTML(s,t),plib.loopArray(e.getElementsByTagName(html.input),function(e){e.type===types.password&&(e.value="")}),pfunc.formFocus(e)):plib.removeChildren(s)},formFocus:function(e){pfunc.loopFormFields(e,function(){if(!this.value)return this.focus(),null})},checkRequired:function(e,t){var s=0,i=function(e){var t=plib.getParentByClassName(e,classes.formLabel);t||(t=plib.getParentByClassName(e,classes.formLabelSm)),e.value&&""!==e.value?t&&plib.removeClass(t,classes.formErrorRow):(s++,t&&plib.addClass(t,classes.formErrorRow))};return 1===t.length?t[0]===asterisk?pfunc.loopFormFields(e,function(){i(this)}):i(e.elements[t[0]]):t.length>0&&plib.loopArray(t,function(t){i(e.elements[t])}),s>0?(pfunc.displayFormError(e,messages.missingReqInput),!1):(pfunc.displayFormError(e,null),!0)},enableFormElement:function(e){return plib.attribute(e,attributes.disabled,null),e.nodeName.toLowerCase()===html.input&&plib.attribute(e,attributes.readonly,null),e},disableFormElement:function(e){return plib.attribute(e,attributes.disabled,attributes.disabled),e.nodeName.toLowerCase()===html.input&&plib.attribute(e,attributes.readonly,attributes.readonly),e},disableForm:function(e){var t=plib.getElementsByClassName(classes.formBtnSubmit,e)[0];plib.loopArray(e.elements,function(e){pfunc.disableFormElement(e)}),t&&pfunc.waitButton(t,messages.formWait)},enableForm:function(e){var t=plib.getElementsByClassName(classes.formBtnSubmit,e)[0];plib.loopArray(e.elements,function(e){pfunc.enableFormElement(e)}),t&&pfunc.unwaitButton(t)},manageTagSuggestionList:function(e){var t=plib.domAppend(html.div,e,{class:classes.formDropDownDiv}),s=e.elements[names.strTagName],i=plib.getCumulativeOffset(s),n=plib.getCumulativeOffset(t.parentNode),o=function(e){plib.addEvent(e,events.mousedown,function(e){plib.stopBubble(e)})},a=function(i){clearTimeout(t.timeout),i?t.timeout=setTimeout(function(){plib.removeChildren(t),plib.appendText(t,messages.loading),plib.show(t),plib.loadJSONP(directory.names.getTagSugg,{strChars:i},function(i){plib.removeChildren(t),plib.hasClass(s.parentNode,classes.focus)&&(null===i?plib.appendText(t,messages.timeoutError):plib.isUndefined(i)?plib.textContent(t,messages.noResults):plib.loopArray(i,function(i){var n,a;(a={})[attributes.tagWebLink]=i[serverKeys.tags.webLink],a[attributes.tagKeywords]=i[serverKeys.tags.keywords].join(", "),n=plib.domAppend(html.span,t,a),(a={})[attributes.className]=classes.iconLabel,plib.domAppend(html.span,n,a),plib.appendText(n,i[serverKeys.tags.name]),o(n),plib.click(n,function(){e.elements[names.strTagName].value=plib.textContent(this),e.elements[names.strWebLink].value=plib.attribute(this,attributes.tagWebLink),e.elements[names.strKeywords].value=plib.attribute(this,attributes.tagKeywords),s.blur()},!0)}))})},300):(plib.removeChildren(t),plib.hide(t))};t.style[css.left]=String(i.x-n.x-9)+cssUnit,t.style[css.top]=String(i.y-n.y+33)+cssUnit,plib.addEvent(s,events.focus,function(){plib.addClass(this.parentNode,classes.focus),this.value&&a(this.value)}),plib.addEvent(s,events.blur,function(){plib.removeClass(this.parentNode,classes.focus),plib.removeChildren(t),plib.hide(t)}),plib.addEvent(s,events.keyup,function(){a(this.value)}),plib.hide(t)},currencyFormat:function(e){var t,s;return e=e.toString().replace(regex.nump,""),e=isNaN(e)?"0":e,t=function(e){return parseFloat(e)<0?"-":""}(e),e=Math.floor(100*Math.abs(e)+.50000000001),s=function(e){return(e=String(e%100)).length<2&&(e="0"+e),e}(e),e=function(e){var t;for(e=e.toString(),t=0;t<Math.floor((e.length-(1+t))/3);t++)e=e.substring(0,e.length-(4*t+3))+","+e.substring(e.length-(4*t+3));return e}(Math.floor(e/100)),t+monetarySymbol+e+"."+s},urlFormat:function(e){var t=plib.parseUrl(e),s=["http","https"];return t.protocol&&plib.inArray(s,t.protocol)||(e=defaultWebProto+t.host+t.relative),e},validWebUrl:function(e){plib.addEvent(e,events.change,function(){this.value=pfunc.urlFormat(this.value)}),""===e.value?e.value=defaultWebProto:plib.fireEvent(e,events.change)},getCanvasContext:function(e,t){return plib.isUndefined(window[oNamespace.vmlCanvas])||window[oNamespace.vmlCanvas].initElement(e),t?e.getContext(t):!!e.getContext},getStylePrefixes:function(e){var t=[plib.camelize(e)];return plib.loopArray(["webkit","moz","o","ms","khtml"],function(s){t[t.length]=plib.camelize("-"+s+"-"+e)}),t},checkSupport:function(){var e,t,s=document.createElement(html.div),i=document.createElement(html.canvas);s.innerHTML='<span style="float:left;opacity:.55;"></span>',e=s.getElementsByTagName(html.span)[0],support.cssFloat=e.style.cssFloat?"cssFloat":"styleFloat",support.opacity=regex.opacity.test(e.style[css.opacity]),support.propertychange=plib.hasProperty(document,"onpropertychange")?"propertychange":"DOMAttrModified",support.canvas=pfunc.getCanvasContext(i),t=s.style.color,pfunc.attempt(function(){s.style.color="rgba(0, 0, 0, 0.5)"}),support.rgba=s.style.color!==t,support.boxShadow=!1,plib.loopArray(pfunc.getStylePrefixes("box-shadow"),function(e){if(!plib.isUndefined(s.style[e]))return support.boxShadow=!0,null}),support.borderRadius=!1,plib.loopArray(pfunc.getStylePrefixes("border-radius"),function(e){if(!plib.isUndefined(s.style[e]))return support.borderRadius=!0,null})},setFluidWidth:function(e){var t=plib.getWidth(e);plib.setWidth(e,"auto"),plib.setStyle(e,css.cssFloat,"left"),plib.attribute(e,attributes.fluidWidth,plib.getWidth(e)),plib.setWidth(e,t),plib.setStyle(e,css.cssFloat,"none")},isValidEmail:function(e){var t=e.lastIndexOf("@"),s=e.lastIndexOf(".");return!(t<1)&&(t!==e.length-1&&(!(t>64)&&(!(e.length-t>255)&&(s>t+1&&s<e.length-1||"["===e.charAt(t+1)&&"]"===e.charAt(e.length-1)))))},manageBackToLogin:function(e,t){plib.click(plib.getElementsByClassName(classes.formOption_backToLogin,e)[0],function(){pfunc.promptLogin(t)})},manageRegistration:function(e,t){plib.click(plib.getElementsByClassName(classes.formOption_register,e)[0],function(){pfunc.promptRegister(t)})},manageForgotPass:function(e,t){plib.click(plib.getElementsByClassName(classes.formOption_forgotPass,e)[0],function(){pfunc.openWindow(layout.formForgot,function(){var e=document.forms[names.formForgot];pfunc.manageBackToLogin(e,t),pfunc.manageFormSubmit(e,directory.names.forgot,[asterisk],function(e){e?pfunc.displayFormError(this,e):(pfunc.openWindow(layout.msgForgot),userLogged&&pfunc.promptLogout(),t&&t())})})})},promptRegister:function(e){pfunc.openWindow(layout.formRegister,function(){var t=document.forms[names.formRegister];pfunc.manageBackToLogin(t,e),t.elements[names.strWebURL].value=plib.parseUrl(windowLocation).host.split(".").slice(-2).join("."),pfunc.validWebUrl(t.elements[names.strWebURL]),pfunc.manageFormSubmit(t,directory.names.register,[asterisk],function(t){plib.isString(t)?pfunc.displayFormError(this,t):plib.isUndefined(t)&&(pfunc.openWindow(layout.msgRegistered),e&&e(t))},function(e){var t=e[names.strUsername];if(!pfunc.isValidEmail(t))return this.elements[names.strUsername].value="",messages.invalidEmail})})},promptLogin:function(e){pfunc.openWindow(layout.formLogin,function(){var t=document.forms[names.formLogin];pfunc.manageForgotPass(t,e),pfunc.manageRegistration(t,e),pfunc.manageFormSubmit(t,directory.names.login,[asterisk],function(t){plib.isString(t)?pfunc.displayFormError(this,t):plib.isObject(t)&&(userLogged=!0,nLastLoginCheck=0,pfunc.updateUserInfo(t),pfunc.methodSessionChange(),pfunc.closeWindow(),settings.onLogin&&settings.onLogin.call(window[oNamespace.root],t),e&&e())},function(e){var t=e[names.strUsername];if(!pfunc.isValidEmail(t))return this.elements[names.strUsername].value="",messages.invalidEmail})})},promptLogout:function(){plib.loadJSONP(directory.names.logout),userLogged=!1,nLastLoginCheck=0,pfunc.updateUserInfo(null),pfunc.methodSessionChange(),settings.onLogout&&settings.onLogout.call(window[oNamespace.root])},methodSessionChange:function(e){var t=plib.getParamsFromObject(userInfo),s=function(e){var t=this;e!==userHash&&t.ui.destroy(),t.updateNode(!0),t.ui.check()};e?s.call(e,t):plib.loopObject(cacheNodes,function(e){s.call(e.instance,t)}),userHash=t},findImageByString:function(e){var t,s=document.getElementById(e);return s?t=s:plib.loopArray(document.getElementsByTagName(html.img),function(s){plib.attribute(s,attributes.src)!==e&&s.src!==e||(t=s)}),t},verifyImageReference:function(e,t){plib.isString(e)&&(e=pfunc.findImageByString(e)),e&&plib.isElement(e)?t&&t(e):pfunc.warn(messages.noImage)},getInstanceByImage:function(e){var t,s=plib.getGUID(e);return s&&plib.loopObject(cacheNodes,function(e,i){i.imgGUID===s&&(t=e)}),t?cacheNodes[t].instance:void 0},manageUserInputImage:function(e,t){pfunc.verifyImageReference(e,function(e){var s=pfunc.getInstanceByImage(e);s?t&&t(s):pfunc.warn(messages.noInstance)})},getTagGuidObject:function(e){var t={tagGUID:plib.attribute(e,attributes.tagGuid)};return t.tagGUID||(delete t.tagGUID,t.tagMultiGUID=plib.attribute(e,attributes.tagMultiGuid)),t.tagMultiGUID||delete t.tagMultiGUID,plib.isObjectEmpty(t)?void 0:t},promptAddTag:function(e){var t=function(){this.startTaggingMode(this.methodAddNewTag)};pfunc.manageUserInputImage(e,function(e){pfunc.checkLogin(function(){t.call(e)},function(){pfunc.promptLogin(function(){t.call(e)})})})},promptRepositionTags:function(e){pfunc.manageUserInputImage(e,function(e){pfunc.checkLogin(function(){e.startTagRepositionMode()},function(){pfunc.promptLogin(function(){e.startTagRepositionMode()})})})},promptRemoveTags:function(e){pfunc.manageUserInputImage(e,function(e){pfunc.checkLogin(function(){e.startTagRemovalMode()},function(){pfunc.promptLogin(function(){e.startTagRemovalMode()})})})},promptOpenLightbox:function(e){var t,s,i,n,o,a,l,r=0,c=0,p=[],m=function(e){var t=n.children[e],s=function(e){plib.show(e),pfunc.centerVertical(i),pfunc.centerHorizontal(i)};plib.loopArray(n.children,plib.hide),"img"===t.nodeName.toLowerCase()?pfunc.onImageDimensionReady(t,function(){s(this),pfunc.loadImage(this);var e=cacheNodes[this.pinUID];e&&p.push(e)}):s(t)},d=function(){(r-=1)<0&&(r=l),m(r)},u=function(){(r+=1)>l&&(r=0),m(r)};!function(){var e=plib.getElementsByClassName(classes.lightboxOverlay)[0];e&&plib.fireEvent(e,"click")}(),plib.isObjectEmpty(cacheImages)||(t=plib.domAppend(html.div,globalElements.pInstActive,{class:classes.lightbox}),s=plib.domAppend(html.div,t,{class:classes.lightboxOverlay}),i=plib.domAppend(html.div,t,{class:classes.lightboxWindow}),n=plib.domAppend(html.div,i,{class:classes.lightboxImageHolder}),o=plib.domAppend(html.div,i,{class:classes.lightboxNav+whiteSpace+classes.lightboxShowLeft}),a=plib.domAppend(html.div,i,{class:classes.lightboxNav+whiteSpace+classes.lightboxShowRight}),plib.domAppend(html.span,o,{class:classes.lightboxNavIcon}),plib.domAppend(html.span,a,{class:classes.lightboxNavIcon}),plib.click(s,function(){plib.loopArray(p,function(e){e&&e.instance.destroy()}),p=[],plib.removeElement(t)}),plib.click(o,d),plib.click(a,u),pfunc.newKeyListener(keyCodes.arrowLeft,t,d),pfunc.newKeyListener(keyCodes.arrowRight,t,u),plib.loopObject(cacheImages,function(t,s){t===e.pinUID&&(r=c),s.loaded&&s.image.src!==window.location.href&&(plib.domAppend(html.img,n,{class:classes.lightboxImage,src:s.image.src}),c+=1)}),l=c-1,m(r))},promptSettings:function(e){pfunc.openPrivateWindow(layout.formSettings,function(){var t=document.forms[names.formSettings];plib.click(t.elements[names.btnRepositionTags],function(){pfunc.promptRepositionTags(e),pfunc.closeWindow()}),plib.click(t.elements[names.btnRemoveTags],function(){pfunc.promptRemoveTags(e),pfunc.closeWindow()}),plib.click(t.elements[names.btnOpenLightbox],function(){pfunc.closeWindow(),pfunc.promptOpenLightbox(e)}),cacheTagData[e.src]&&cacheTagData[e.src][1]?(plib.show(t.elements[names.btnRepositionTags]),plib.show(t.elements[names.btnRemoveTags])):(plib.hide(t.elements[names.btnRepositionTags]),plib.hide(t.elements[names.btnRemoveTags]))})},startDragging:function(e){plib.addEvent(document,events.mousemove,function(t){var s=plib.getMousePosition(t),i=plib.getCumulativeOffset(e.parentNode),n=s.x-i.x,o=s.y-i.y,a=plib.getWidth(e.parentNode),l=plib.getHeight(e.parentNode),r={};n<10?n=10:n>a-10-1&&(n=a-10-1),o<10?o=10:o>l-10-1&&(o=l-10-1),plib.attribute(e,attributes.tagPosX,(n/a).toFixed(10)),plib.attribute(e,attributes.tagPosY,(o/l).toFixed(10)),r[css.left]=n,r[css.top]=o,plib.setStyles(e,r)})},stopDragging:function(){plib.removeEvent(document,events.mousemove)},getLocalStorage:function(e){var t,s,i;return settings.allowLocalStorage&&window.localStorage&&window.JSON&&(i=(t=localStorage.getItem(e).split("_")).shift(),s=t.join("_"),i===BOOLEAN_TYPE?s="true"===s:i===NUMBER_TYPE?s=parseFloat(s):i===DATE_TYPE?s=new Date(s):i!==ARRAY_TYPE&&i!==OBJECT_TYPE||(s=JSON.parse(s))),s},setLocalStorage:function(e,t){var s;if(settings.allowLocalStorage&&window.localStorage&&window.JSON){if((s=plib.type(t))===NULL_TYPE||s===UNDEFINED_TYPE||s===ELEMENT_TYPE||s===FUNCTION_TYPE)return;s===BOOLEAN_TYPE||s===NUMBER_TYPE||s===DATE_TYPE?t=t.toString():s!==ARRAY_TYPE&&s!==OBJECT_TYPE||(t=JSON.stringify(t)),localStorage.setItem(e,s+"_"+t)}},manageTheme:function(e){var t,s;e&&""!==e&&(s=parseInt(e.split(".")[0],10),plib.getStyle(globalElements.pInstWrapper,css.zIndex)!==s&&((t={})[attributes.href]=directory.paths.themes+e,t[attributes.rel]="stylesheet",t[attributes.type]=types.csstxt,plib.domAppend(html.link,document.getElementsByTagName(html.head)[0],t)),plib.addClass(globalElements.pInstActive,cssPrefix+s),pfunc.info(messages.themeLoaded,s))},changeTheme:function(e){plib.loopObject(cacheNodes,function(e){e.instance.destroy()}),pfunc.manageTheme(e),pfunc.checkForImages()},log:function(){pfunc.print(arguments,0)},info:function(){pfunc.print(arguments,1)},warn:function(){pfunc.print(arguments,2)},error:function(){pfunc.print(arguments,3)},time:function(){pfunc.print(arguments,4)},timeEnd:function(){pfunc.print(arguments,5)},print:function(e,t){t=consoleMethods[t],plib.isUndefined(consoleObject)||plib.isNull(consoleObject)||(e=Array.prototype.slice.call(e),plib.isFunction(consoleObject[t])?consoleObject[t].apply(consoleObject,e):plib.isObject(consoleObject[t])&&Function.prototype.call.call(consoleObject[t],consoleObject,e))},attempt:function(e){try{e.call()}catch(e){pfunc.error(sysName+plib.stringFormat(": ({0}) {1}: {2}",[e.number,e.name,e.message]))}},isMobile:function(){return regex.mobile.test(navigator.userAgent)}},window[oNamespace.root]=Pinup;